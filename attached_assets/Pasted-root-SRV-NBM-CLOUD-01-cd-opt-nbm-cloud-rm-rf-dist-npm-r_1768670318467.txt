root@SRV-NBM-CLOUD-01[~]# cd /opt/nbm-cloud
rm -rf dist
npm run build
pm2 restart nbm-cloud --update-env

> rest-express@1.0.0 build
> tsx script/build.ts

building client...
vite v7.3.0 building client environment for production...
✓ 3327 modules transformed.
../dist/public/index.html                     2.87 kB │ gzip:   1.04 kB
../dist/public/assets/index-CYXtfQtz.css     86.02 kB │ gzip:  14.56 kB
../dist/public/assets/index-B5L89Ta3.js   1,754.04 kB │ gzip: 470.18 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 14.27s
building server...

  dist/index.cjs  1.4mb ⚠️

⚡ Done in 196ms
[PM2] Applying action restartProcessId on app [nbm-cloud](ids: [ 0 ])
[PM2] [nbm-cloud](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ nbm-cloud          │ fork     │ 2748 │ online    │ 0%       │ 18.3mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
root@SRV-NBM-CLOUD-01[/opt/nbm-cloud]# grep "Terminal SSH Interativo" dist/public/assets/index-*.js
`)&&j.writeln("")}else P.message&&j.writeln(`\x1B[1;31mErro: ${P.message}\x1B[0m`)}catch(E){j.writeln(`\x1B[1;31mErro: ${E.message||"Falha ao executar comando"}\x1B[0m`)}finally{d(!1)}}},[e]),x=b.useCallback(()=>{if(!n.current)return;const S=new hPe({cursorBlink:!0,cursorStyle:"block",fontFamily:"'JetBrains Mono', 'Fira Code', 'Consolas', monospace",fontSize:14,theme:{background:"#1a1b26",foreground:"#a9b1d6",cursor:"#c0caf5",cursorAccent:"#1a1b26",selectionBackground:"#33467c",black:"#32344a",red:"#f7768e",green:"#9ece6a",yellow:"#e0af68",blue:"#7aa2f7",magenta:"#ad8ee6",cyan:"#449dab",white:"#787c99",brightBlack:"#444b6a",brightRed:"#ff7a93",brightGreen:"#b9f27c",brightYellow:"#ff9e64",brightBlue:"#7da6ff",brightMagenta:"#bb9af7",brightCyan:"#0db9d7",brightWhite:"#acb0d0"},allowProposedApi:!0}),j=new mPe,E=new _Pe;S.loadAddon(j),S.loadAddon(E),S.open(n.current),j.fit(),i.current=S,s.current=j;const P=N=>{N.write("\x1B[1;32m"+t+"\x1B[0m:\x1B[1;34m~\x1B[0m$ ")};S.writeln("\x1B[1;36m╔════════════════════════════════════════════╗\x1B[0m"),S.writeln("\x1B[1;36m║\x1B[0m   \x1B[1;33mNBM CLOUD\x1B[0m - Terminal Remoto              \x1B[1;36m║\x1B[0m"),S.writeln("\x1B[1;36m╚════════════════════════════════════════════╝\x1B[0m"),S.writeln(""),S.writeln(`\x1B[1;32m✓ Conectado ao agente: ${t}\x1B[0m`),S.writeln("\x1B[90mDigite comandos Linux e pressione Enter para executar.\x1B[0m"),S.writeln("\x1B[90mUse ↑/↓ para histórico. Comandos: clear, help, exit\x1B[0m"),S.writeln(""),l(!0),P(S),S.onData(async N=>{if(!u)if(N==="\r"){S.writeln("");const T=f.current.trim();f.current="",g.current=-1,T&&(p.current.push(T),p.current.length>100&&p.current.shift()),T==="clear"?(S.clear(),P(S)):T==="exit"?(S.writeln("\x1B[1;33m═══ Sessão encerrada ═══\x1B[0m"),l(!1),r&&r()):T==="help"?(S.writeln("\x1B[1;33mComandos disponíveis:\x1B[0m"),S.writeln("  \x1B[36mclear\x1B[0m       - Limpar terminal"),S.writeln("  \x1B[36mexit\x1B[0m        - Encerrar sessão"),S.writeln("  \x1B[36mhelp\x1B[0m        - Exibir esta ajuda"),S.writeln("  \x1B[36m<comando>\x1B[0m   - Executar comando no servidor do agente"),S.writeln(""),S.writeln("\x1B[90mExemplos: ls -la, df -h, free -m, cat /etc/os-release\x1B[0m"),S.writeln(""),P(S)):(T&&await v(T,S),P(S))}else if(N===""||N==="\b")f.current.length>0&&(f.current=f.current.slice(0,-1),S.write("\b \b"));else if(N==="")f.current="",S.writeln("^C"),P(S);else if(N==="\x1B[A"){if(p.current.length>0){const T=g.current<p.current.length-1?g.current+1:g.current;for(g.current=T;f.current.length>0;)S.write("\b \b"),f.current=f.current.slice(0,-1);const M=p.current[p.current.length-1-T];f.current=M,S.write(M)}}else if(N==="\x1B[B"){if(g.current>0){for(g.current--;f.current.length>0;)S.write("\b \b"),f.current=f.current.slice(0,-1);const T=p.current[p.current.length-1-g.current];f.current=T,S.write(T)}else if(g.current===0)for(g.current=-1;f.current.length>0;)S.write("\b \b"),f.current=f.current.slice(0,-1)}else N>=" "&&N<="~"&&(f.current+=N,S.write(N))});const C=()=>{s.current&&s.current.fit()};return window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C),S.dispose()}},[t,u,v,r]);b.useEffect(()=>{const S=x();return()=>{S&&S()}},[]);const y=()=>{l(!1),r&&r()},_=()=>{i.current&&(i.current.dispose(),i.current=null),f.current="",p.current=[],g.current=-1,setTimeout(x,100)};return a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`w-2 h-2 rounded-full ${o?"bg-green-500":u?"bg-yellow-500 animate-pulse":"bg-red-500"}`}),a.jsx("span",{className:"text-sm text-gray-300",children:o?u?"Executando...":`Conectado: ${t}`:"Desconectado"})]}),a.jsxs("div",{className:"flex gap-2",children:[!o&&a.jsx("button",{onClick:_,className:"px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded","data-testid":"button-reconnect",children:"Reconectar"}),a.jsx("button",{onClick:y,className:"px-3 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded","data-testid":"button-disconnect",children:"Desconectar"})]})]}),a.jsx("div",{ref:n,className:"flex-1 bg-[#1a1b26]",style:{minHeight:"400px"},"data-testid":"xterm-container"})]})}function SPe(){const{t:e}=Tr(),{toast:t}=pn(),[r,n]=b.useState(""),[i,s]=b.useState(""),[o,l]=b.useState([]),[u,d]=b.useState([]),[f,p]=b.useState(-1),[g,v]=b.useState(null),[x,y]=b.useState(""),[_,S]=b.useState("22"),j=b.useRef(null);b.useRef(null);const{data:E=[],isLoading:P}=Pt({queryKey:["/api/agents"]}),C=E.filter(F=>F.status==="online"),N=st({mutationFn:async F=>(await _t("GET",`/api/agents/${F}/diagnostics`)).json(),onSuccess:F=>{F.success?(v(F.diagnostics),q("[SYSTEM] Diagnóstico recebido com sucesso")):q(`[ERROR] ${F.message}`)},onError:F=>{q(`[ERROR] Falha ao obter diagnóstico: ${F.message}`)}}),T=st({mutationFn:async({agentId:F,command:L})=>(await _t("POST",`/api/agents/${F}/terminal`,{command:L})).json(),onSuccess:F=>{F.success?q(F.output):q(`[ERROR] ${F.message}`)},onError:F=>{q(`[ERROR] Falha ao executar comando: ${F.message}`)}}),M=st({mutationFn:async({agentId:F,targetIp:L,targetPort:Y})=>(await _t("POST",`/api/agents/${F}/test-connection`,{targetIp:L,targetPort:Y,protocol:"ssh"})).json(),onSuccess:F=>{if(F.success&&F.result){const{reachable:L,latency:Y,error:U}=F.result;L?(q(`[TEST] Conexão OK - Latência: ${Y}ms`),t({title:"Conexão bem sucedida",description:`Latência: ${Y}ms`})):(q(`[TEST] Conexão falhou: ${U}`),t({title:"Conexão falhou",description:U,variant:"destructive"}))}else q(`[ERROR] ${F.message}`)},onError:F=>{q(`[ERROR] Teste de conexão falhou: ${F.message}`)}}),R=st({mutationFn:async({agentId:F,updateType:L})=>(await _t("POST",`/api/agents/${F}/update`,{updateType:L})).json(),onSuccess:F=>{F.success?(q("[UPDATE] Atualização iniciada com sucesso"),t({title:"Atualização iniciada"})):q(`[ERROR] ${F.message}`)},onError:F=>{q(`[ERROR] Falha na atualização: ${F.message}`)}}),H=st({mutationFn:async({agentId:F,action:L,force:Y})=>(await _t("POST",`/api/agents/${F}/admin`,{action:L,force:Y})).json(),onSuccess:(F,L)=>{if(F.success){const Y={reboot:"Reiniciar servidor",shutdown:"Desligar servidor",restart_service:"Reiniciar serviço do agente",restart_agent:"Reiniciar processo do agente",service_status:"Status do serviço"};q(`[ADMIN] ${Y[L.action]||L.action}: Comando enviado`),F.result?.output&&q(F.result.output),t({title:"Comando executado",description:`${Y[L.action]} enviado com sucesso`})}else q(`[ERROR] ${F.message}`),t({title:"Erro",description:F.message,variant:"destructive"})},onError:F=>{q(`[ERROR] Falha no comando admin: ${F.message}`),t({title:"Erro",description:F.message,variant:"destructive"})}}),q=F=>{const L=new Date().toLocaleTimeString();l(Y=>[...Y,`[${L}] ${F}`])};b.useEffect(()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)},[o]),b.useEffect(()=>{r&&(q(`Conectado ao agente #${r}`),q("Digite 'help' para ver os comandos disponíveis"))},[r]);const D=F=>{if(F===0)return"0 B";const L=1024,Y=["B","KB","MB","GB","TB"],U=Math.floor(Math.log(F)/Math.log(L));return parseFloat((F/Math.pow(L,U)).toFixed(2))+" "+Y[U]},I=F=>{const L=Math.floor(F/86400),Y=Math.floor(F%86400/3600),U=Math.floor(F%3600/60);return`${L}d ${Y}h ${U}m`},O=E.find(F=>F.id===parseInt(r));return a.jsxs("div",{className:"p-6 md:p-8 space-y-6 animate-enter",children:[a.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 md:items-center",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Bf,{href:"/agents",children:a.jsx(se,{variant:"ghost",size:"icon","data-testid":"button-back-agents",children:a.jsx(OX,{className:"h-5 w-5"})})}),a.jsx(pa,{className:"h-8 w-8 text-primary"}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Console do Agente"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Diagnóstico, terminal e gerenciamento remoto"})]})]}),a.jsx("div",{className:"flex items-center gap-3",children:a.jsxs(ar,{value:r,onValueChange:n,children:[a.jsx(er,{className:"w-[250px]","data-testid":"select-agent",children:a.jsx(or,{placeholder:"Selecione um agente"})}),a.jsx(tr,{children:C.length===0?a.jsx(tt,{value:"none",disabled:!0,children:"Nenhum agente online"}):C.map(F=>a.jsx(tt,{value:F.id.toString(),children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),F.name]})},F.id))})]})})]}),r?a.jsxs(lh,{defaultValue:"terminal",className:"w-full",children:[a.jsxs(Qc,{className:"grid w-full grid-cols-4","data-testid":"tabs-agent-console",children:[a.jsxs(Cn,{value:"terminal","data-testid":"tab-terminal",children:[a.jsx(pa,{className:"h-4 w-4 mr-2"}),"Terminal"]}),a.jsxs(Cn,{value:"diagnostics","data-testid":"tab-diagnostics",children:[a.jsx($f,{className:"h-4 w-4 mr-2"}),"Diagnóstico"]}),a.jsxs(Cn,{value:"tools","data-testid":"tab-tools",children:[a.jsx(ss,{className:"h-4 w-4 mr-2"}),"Ferramentas"]}),a.jsxs(Cn,{value:"admin","data-testid":"tab-admin",children:[a.jsx(Nc,{className:"h-4 w-4 mr-2"}),"Administração"]})]}),a.jsx(jn,{value:"terminal",className:"mt-4",children:a.jsxs(Ue,{className:"overflow-hidden",children:[a.jsxs(bt,{className:"pb-3",children:[a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(pa,{className:"h-5 w-5"}),"Terminal SSH Interativo"]}),a.jsx(zt,{children:"Shell interativo conectado diretamente ao servidor do agente via SSH"})]}),a.jsx(We,{className:"p-0",children:a.jsx("div",{className:"h-[500px]","data-testid":"terminal-container",children:a.jsx(wPe,{agentId:parseInt(r),agentName:C.find(F=>F.id===parseInt(r))?.name||"Agente"})})})]})}),a.jsx(jn,{value:"diagnostics",className:"mt-4",children:a.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[a.jsxs(Ue,{children:[a.jsx(bt,{className:"pb-3",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(vr,{className:"h-5 w-5"}),"Sistema"]}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>N.mutate(parseInt(r)),disabled:N.isPending,"data-testid":"button-refresh-diagnostics",children:N.isPending?a.jsx(jr,{className:"h-4 w-4 animate-spin"}):a.jsx(bc,{className:"h-4 w-4"})})]})}),a.jsx(We,{children:g?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Hostname"}),a.jsx("span",{className:"font-mono",children:g.system.hostname})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Plataforma"}),a.jsxs("span",{children:[g.system.platform," (",g.system.arch,")"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Uptime"}),a.jsx("span",{children:I(g.system.uptime)})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Versão do Agente"}),a.jsx(Qe,{variant:"outline",children:g.system.agentVersion})]})]}):a.jsx("p",{className:"text-muted-foreground text-sm",children:"Clique em atualizar para obter diagnóstico"})})]}),a.jsxs(Ue,{children:[a.jsx(bt,{className:"pb-3",children:a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(aM,{className:"h-5 w-5"}),"CPU & Memória"]})}),a.jsx(We,{children:g?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"CPU"}),a.jsx("span",{children:g.cpu.model})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Cores"}),a.jsx("span",{children:g.cpu.cores})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Uso CPU"}),a.jsxs(Qe,{variant:g.cpu.usage>80?"destructive":"secondary",children:[g.cpu.usage.toFixed(1),"%"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Memória"}),a.jsxs("span",{children:[D(g.memory.used)," / ",D(g.memory.total)]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Uso Memória"}),a.jsxs(Qe,{variant:g.memory.usedPercent>80?"destructive":"secondary",children:[g.memory.usedPercent.toFixed(1),"%"]})]})]}):a.jsx("p",{className:"text-muted-foreground text-sm",children:"Aguardando diagnóstico..."})})]}),a.jsxs(Ue,{children:[a.jsx(bt,{className:"pb-3",children:a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(zf,{className:"h-5 w-5"}),"Rede"]})}),a.jsx(We,{children:g?.network?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-muted-foreground",children:"Conexão com Servidor"}),g.network.serverConnection.connected?a.jsxs(Qe,{className:"bg-green-500",children:[a.jsx(qj,{className:"h-3 w-3 mr-1"}),g.network.serverConnection.latency,"ms"]}):a.jsxs(Qe,{variant:"destructive",children:[a.jsx(IX,{className:"h-3 w-3 mr-1"}),"Desconectado"]})]}),a.jsx("div",{className:"text-sm text-muted-foreground",children:"Interfaces:"}),g.network.interfaces.map((F,L)=>a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"font-mono",children:F.name}),a.jsx("span",{className:"font-mono",children:F.ip})]},L))]}):a.jsx("p",{className:"text-muted-foreground text-sm",children:"Aguardando diagnóstico..."})})]}),a.jsxs(Ue,{children:[a.jsx(bt,{className:"pb-3",children:a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(Ec,{className:"h-5 w-5"}),"Equipamentos"]})}),a.jsx(We,{children:g?.equipment?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Total"}),a.jsx("span",{children:g.equipment.total})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Alcançáveis"}),a.jsx(Qe,{className:"bg-green-500",children:g.equipment.reachable})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Inalcançáveis"}),a.jsx(Qe,{variant:"destructive",children:g.equipment.unreachable})]})]}):a.jsx("p",{className:"text-muted-foreground text-sm",children:"Aguardando diagnóstico..."})})]})]})}),a.jsx(jn,{value:"tools",className:"mt-4",children:a.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[a.jsxs(Ue,{children:[a.jsxs(bt,{className:"pb-3",children:[a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(ss,{className:"h-5 w-5"}),"Teste de Conexão"]}),a.jsx(zt,{children:"Testar conectividade com um equipamento através do agente"})]}),a.jsxs(We,{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsxs("div",{className:"col-span-2",children:[a.jsx(Me,{children:"IP do Equipamento"}),a.jsx(Ne,{value:x,onChange:F=>y(F.target.value),placeholder:"192.168.1.1","data-testid":"input-test-ip"})]}),a.jsxs("div",{children:[a.jsx(Me,{children:"Porta"}),a.jsx(Ne,{value:_,onChange:F=>S(F.target.value),placeholder:"22","data-testid":"input-test-port"})]})]}),a.jsxs(se,{onClick:()=>M.mutate({agentId:parseInt(r),targetIp:x,targetPort:parseInt(_)||22}),disabled:M.isPending||!x,className:"w-full","data-testid":"button-test-connection",children:[M.isPending?a.jsx(jr,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx(Pc,{className:"h-4 w-4 mr-2"}),"Testar Conexão"]})]})]}),a.jsxs(Ue,{children:[a.jsxs(bt,{className:"pb-3",children:[a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(es,{className:"h-5 w-5"}),"Atualização do Agente"]}),a.jsx(zt,{children:"Atualizar o agente para a versão mais recente"})]}),a.jsxs(We,{className:"space-y-4",children:[a.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[a.jsxs("div",{className:"flex justify-between mb-2",children:[a.jsx("span",{className:"text-muted-foreground",children:"Versão Atual"}),a.jsx(Qe,{variant:"outline",children:O?.config?.version||"1.0.0"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Status"}),a.jsx(Qe,{className:"bg-green-500",children:"Online"})]})]}),a.jsxs(se,{onClick:()=>R.mutate({agentId:parseInt(r),updateType:"full"}),disabled:R.isPending,variant:"outline",className:"w-full","data-testid":"button-update-agent",children:[R.isPending?a.jsx(jr,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx(bc,{className:"h-4 w-4 mr-2"}),"Atualizar Agente"]})]})]})]})}),a.jsx(jn,{value:"admin",className:"mt-4",children:a.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[a.jsxs(Ue,{children:[a.jsxs(bt,{className:"pb-3",children:[a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(vr,{className:"h-5 w-5"}),"Controle do Servidor"]}),a.jsx(zt,{children:"Gerenciar o servidor onde o agente está instalado"})]}),a.jsx(We,{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs(is,{children:[a.jsx(js,{asChild:!0,children:a.jsxs(se,{variant:"outline",className:"w-full","data-testid":"button-reboot-server",children:[a.jsx(Bv,{className:"h-4 w-4 mr-2"}),"Reiniciar Servidor"]})}),a.jsxs(Mi,{children:[a.jsxs(Di,{children:[a.jsxs(Ii,{className:"flex items-center gap-2",children:[a.jsx(uM,{className:"h-5 w-5 text-amber-500"}),"Reiniciar Servidor"]}),a.jsx(Li,{children:"Tem certeza que deseja reiniciar o servidor do agente? O agente ficará offline durante o reboot."})]}),a.jsxs(Ri,{children:[a.jsx(Fi,{children:"Cancelar"}),a.jsx(Bi,{onClick:()=>H.mutate({agentId:parseInt(r),action:"reboot"}),children:"Reiniciar"})]})]})]}),a.jsxs(is,{children:[a.jsx(js,{asChild:!0,children:a.jsxs(se,{variant:"destructive",className:"w-full","data-testid":"button-shutdown-server",children:[a.jsx(h$,{className:"h-4 w-4 mr-2"}),"Desligar Servidor"]})}),a.jsxs(Mi,{children:[a.jsxs(Di,{children:[a.jsxs(Ii,{className:"flex items-center gap-2",children:[a.jsx(uM,{className:"h-5 w-5 text-red-500"}),"Desligar Servidor"]}),a.jsxs(Li,{children:[a.jsx("strong",{children:"ATENÇÃO:"})," Esta ação irá desligar o servidor completamente. Será necessário acesso físico ou IPMI/iLO para ligar novamente."]})]}),a.jsxs(Ri,{children:[a.jsx(Fi,{children:"Cancelar"}),a.jsx(Bi,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>H.mutate({agentId:parseInt(r),action:"shutdown"}),children:"Desligar"})]})]})]})]})})]}),a.jsxs(Ue,{children:[a.jsxs(bt,{className:"pb-3",children:[a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(Nc,{className:"h-5 w-5"}),"Controle do Serviço NBM Agent"]}),a.jsx(zt,{children:"Gerenciar o serviço do agente NBM Cloud"})]}),a.jsxs(We,{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs(se,{variant:"outline",onClick:()=>H.mutate({agentId:parseInt(r),action:"restart_service"}),disabled:H.isPending,className:"w-full","data-testid":"button-restart-service",children:[H.isPending?a.jsx(jr,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx(bc,{className:"h-4 w-4 mr-2"}),"Reiniciar Serviço"]}),a.jsxs(se,{variant:"outline",onClick:()=>H.mutate({agentId:parseInt(r),action:"service_status"}),disabled:H.isPending,className:"w-full","data-testid":"button-service-status",children:[H.isPending?a.jsx(jr,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx($f,{className:"h-4 w-4 mr-2"}),"Status do Serviço"]})]}),a.jsx("div",{className:"pt-2 border-t",children:a.jsxs(se,{variant:"secondary",onClick:()=>H.mutate({agentId:parseInt(r),action:"restart_agent"}),disabled:H.isPending,className:"w-full","data-testid":"button-restart-agent",children:[H.isPending?a.jsx(jr,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx(Bv,{className:"h-4 w-4 mr-2"}),"Reiniciar Processo do Agente"]})})]})]}),a.jsxs(Ue,{className:"md:col-span-2",children:[a.jsxs(bt,{className:"pb-3",children:[a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(pa,{className:"h-5 w-5"}),"Comandos Rápidos"]}),a.jsx(zt,{children:"Executar comandos administrativos comuns"})]}),a.jsx(We,{children:a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[a.jsxs(se,{variant:"outline",onClick:()=>{T.mutate({agentId:parseInt(r),command:"df -h"}),q("$ df -h")},disabled:T.isPending,"data-testid":"button-cmd-disk",children:[a.jsx(Ec,{className:"h-4 w-4 mr-2"}),"Disco"]}),a.jsxs(se,{variant:"outline",onClick:()=>{T.mutate({agentId:parseInt(r),command:"free -h"}),q("$ free -h")},disabled:T.isPending,"data-testid":"button-cmd-memory",children:[a.jsx(aM,{className:"h-4 w-4 mr-2"}),"Memória"]}),a.jsxs(se,{variant:"outline",onClick:()=>{T.mutate({agentId:parseInt(r),command:"uptime"}),q("$ uptime")},disabled:T.isPending,"data-testid":"button-cmd-uptime",children:[a.jsx(bx,{className:"h-4 w-4 mr-2"}),"Uptime"]}),a.jsxs(se,{variant:"outline",onClick:()=>{T.mutate({agentId:parseInt(r),command:"ip addr show"}),q("$ ip addr show")},disabled:T.isPending,"data-testid":"button-cmd-network",children:[a.jsx(zf,{className:"h-4 w-4 mr-2"}),"Rede"]})]})})]})]})})]}):a.jsx(Ue,{children:a.jsxs(We,{className:"p-12 text-center",children:[a.jsx(vr,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),a.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Selecione um Agente"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"Escolha um agente online para acessar o console de diagnóstico e terminal."}),C.length===0&&a.jsxs(Qe,{variant:"outline",className:"text-amber-500 border-amber-500",children:[a.jsx(Gp,{className:"h-3 w-3 mr-1"}),"Nenhum agente online"]})]})})]})}const CPe=hbe,C7=b.createContext({}),ic=({...e})=>a.jsx(C7.Provider,{value:{name:e.name},children:a.jsx(gbe,{...e})}),zb=()=>{const e=b.useContext(C7),t=b.useContext(j7),{getFieldState:r,formState:n}=Eb(),i=r(e.name,n);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:s}=t;return{id:s,name:e.name,formItemId:`${s}-form-item`,formDescriptionId:`${s}-form-item-description`,formMessageId:`${s}-form-item-message`,...i}},j7=b.createContext({}),nl=b.forwardRef(({className:e,...t},r)=>{const n=b.useId();return a.jsx(j7.Provider,{value:{id:n},children:a.jsx("div",{ref:r,className:ke("space-y-2",e),...t})})});nl.displayName="FormItem";const il=b.forwardRef(({className:e,...t},r)=>{const{error:n,formItemId:i}=zb();return a.jsx(Me,{ref:r,className:ke(n&&"text-destructive",e),htmlFor:i,...t})});il.displayName="FormLabel";const sl=b.forwardRef(({...e},t)=>{const{error:r,formItemId:n,formDescriptionId:i,formMessageId:s}=zb();return a.jsx(jE,{ref:t,id:n,"aria-describedby":r?`${i} ${s}`:`${i}`,"aria-invalid":!!r,...e})});sl.displayName="FormControl";const jPe=b.forwardRef(({className:e,...t},r)=>{const{formDescriptionId:n}=zb();return a.jsx("p",{ref:r,id:n,className:ke("text-sm text-muted-foreground",e),...t})});jPe.displayName="FormDescription";const al=b.forwardRef(({className:e,children:t,...r},n)=>{const{error:i,formMessageId:s}=zb(),o=i?String(i?.message??""):t;return o?a.jsx("p",{ref:n,id:s,className:ke("text-sm font-medium text-destructive",e),...r,children:o}):null});al.displayName="FormMessage";var kPe="Separator",d3="horizontal",EPe=["horizontal","vertical"],k7=b.forwardRef((e,t)=>{const{decorative:r,orientation:n=d3,...i}=e,s=NPe(n)?n:d3,l=r?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return a.jsx(Ke.div,{"data-orientation":s,...l,...i,ref:t})});k7.displayName=kPe;function NPe(e){return EPe.includes(e)}var E7=k7;const N7=b.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},i)=>a.jsx(E7,{ref:i,decorative:r,orientation:t,className:ke("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));N7.displayName=E7.displayName;const PPe=ur.object({name:ur.string().min(2,"Nome do proxy deve ter pelo menos 2 caracteres"),siteName:ur.string().min(2,"Nome do site deve ter pelo menos 2 caracteres"),ipAddress:ur.string().optional(),description:ur.string().optional()}),APe=ur.object({name:ur.string().min(2,"Nome deve ter pelo menos 2 caracteres"),slug:ur.string().min(2,"Slug deve ter pelo menos 2 caracteres").regex(/^[a-z0-9-]+$/,"Slug deve conter apenas letras minusculas, numeros e hifens"),description:ur.string().optional(),maxUsers:ur.number().min(1).default(10),maxEquipment:ur.number().min(1).default(100),maxAgents:ur.number().min(1).default(5),active:ur.boolean().default(!0),proxies:ur.array(PPe).optional()});function TPe(){const{t:e}=Tr(),{toast:t}=pn(),[,r]=w3(),[n,i]=b.useState(!1),[s,o]=b.useState(!1),[l,u]=b.useState(!1),[d,f]=b.useState(null),[p,g]=b.useState(""),[v,x]=b.useState([]),[y,_]=b.useState({name:"",siteName:"",ipAddress:"",description:""}),[S,j]=b.useState(""),[E,P]=b.useState("server_admin"),[C,N]=b.useState(""),[T,M]=b.useState(!1),[R,H]=b.useState(null),{data:q,isLoading:D}=Pt({queryKey:["/api/server/check-admin"]}),{data:I,isLoading:O}=Pt({queryKey:["/api/server/stats"]}),{data:F,isLoading:L}=Pt({queryKey:["/api/server/companies"]}),{data:Y,isLoading:U}=Pt({queryKey:["/api/server/agents"]}),{data:W,isLoading:V}=Pt({queryKey:["/api/server/admins"],enabled:q?.serverRole==="server_admin"}),{data:B}=Pt({queryKey:["/api/server/users"],enabled:q?.serverRole==="server_admin"}),z=st({mutationFn:async oe=>await _t("POST","/api/server/companies",oe),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/server/companies"]}),dt.invalidateQueries({queryKey:["/api/server/stats"]}),dt.invalidateQueries({queryKey:["/api/server/agents"]}),i(!1),Ze(),t({title:"Empresa criada com sucesso"})},onError:oe=>{t({title:"Erro ao criar empresa",description:oe.message,variant:"destructive"})}}),Z=st({mutationFn:async oe=>await _t("POST",`/api/server/agents/${oe}/restart`),onSuccess:()=>{t({title:"Comando de reinicio enviado"})},onError:oe=>{t({title:"Erro ao reiniciar agente",description:oe.message,variant:"destructive"})}}),ae=st({mutationFn:async oe=>await _t("POST","/api/server/admins",oe),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/server/admins"]}),o(!1),j(""),P("server_admin"),t({title:"Super Administrador criado com sucesso"})},onError:oe=>{t({title:"Erro ao criar administrador",description:oe.message,variant:"destructive"})}}),K=st({mutationFn:async oe=>await _t("DELETE",`/api/server/admins/${oe}`),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/server/admins"]}),t({title:"Administrador removido com sucesso"})},onError:oe=>{t({title:"Erro ao remover administrador",description:oe.message,variant:"destructive"})}}),re=st({mutationFn:async oe=>await _t("PATCH",`/api/server/admins/${oe.adminId}`,{role:oe.role}),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/server/admins"]}),u(!1),f(null),t({title:"Administrador atualizado com sucesso"})},onError:oe=>{t({title:"Erro ao atualizar administrador",description:oe.message,variant:"destructive"})}}),ee=st({mutationFn:async oe=>await _t("DELETE",`/api/server/companies/${oe}`),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/server/companies"]}),dt.invalidateQueries({queryKey:["/api/server/stats"]}),t({title:"Empresa excluida com sucesso"})},onError:oe=>{t({title:"Erro ao excluir empresa",description:oe.message,variant:"destructive"})}}),ve=st({mutationFn:async oe=>await _t("PATCH",`/api/server/companies/${oe.id}`,oe.updates),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/server/companies"]}),dt.invalidateQueries({queryKey:["/api/server/stats"]}),M(!1),H(null),t({title:"Empresa atualizada com sucesso"})},onError:oe=>{t({title:"Erro ao atualizar empresa",description:oe.message,variant:"destructive"})}}),ie=oe=>{f(oe),N(oe.role),u(!0)},be=oh({resolver:dW(APe),defaultValues:{name:"",slug:"",description:"",maxUsers:10,maxEquipment:100,maxAgents:5,active:!0}}),Ce=oe=>{z.mutate({...oe,proxies:v})},he=()=>{y.name&&y.siteName&&(x([...v,y]),_({name:"",siteName:"",ipAddress:"",description:""}))},Fe=oe=>{x(v.filter((Bt,xr)=>xr!==oe))},Ze=()=>{be.reset(),x([]),_({name:"",siteName:"",ipAddress:"",description:""})},Tt=F?.filter(oe=>oe.name.toLowerCase().includes(p.toLowerCase())||oe.slug.toLowerCase().includes(p.toLowerCase())),Ct=Y?.filter(oe=>oe.name.toLowerCase().includes(p.toLowerCase())||oe.siteName.toLowerCase().includes(p.toLowerCase())||oe.companyName?.toLowerCase().includes(p.toLowerCase()));return D?a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Verificando permissoes..."})}):q?.isServerAdmin?a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsx("div",{className:"p-6 border-b bg-background",children:a.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[a.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:a.jsx(Nc,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-bold","data-testid":"text-page-title",children:"NBM CLOUD Server"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Gerenciamento de empresas e proxies"})]})]})}),a.jsxs("div",{className:"flex-1 overflow-auto p-6 space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(Ue,{children:a.jsxs(We,{className:"pt-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Empresas"}),a.jsx("p",{className:"text-2xl font-bold","data-testid":"text-total-companies",children:O?"-":I?.totalCompanies||0})]}),a.jsx(no,{className:"h-8 w-8 text-muted-foreground/50"})]}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[I?.activeCompanies||0," ativas"]})]})}),a.jsx(Ue,{children:a.jsx(We,{className:"pt-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Proxies"}),a.jsx("p",{className:"text-2xl font-bold","data-testid":"text-total-agents",children:O?"-":I?.totalAgents||0})]}),a.jsx(ss,{className:"h-8 w-8 text-muted-foreground/50"})]})})}),a.jsx(Ue,{children:a.jsx(We,{className:"pt-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Online"}),a.jsx("p",{className:"text-2xl font-bold text-green-600","data-testid":"text-online-agents",children:O?"-":I?.onlineAgents||0})]}),a.jsx($f,{className:"h-8 w-8 text-green-500/50"})]})})}),a.jsx(Ue,{children:a.jsx(We,{className:"pt-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Offline"}),a.jsx("p",{className:"text-2xl font-bold text-red-600","data-testid":"text-offline-agents",children:O?"-":I?.offlineAgents||0})]}),a.jsx(h$,{className:"h-8 w-8 text-red-500/50"})]})})})]}),a.jsxs(lh,{defaultValue:"companies",className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between gap-4",children:[a.jsxs(Qc,{children:[a.jsxs(Cn,{value:"companies","data-testid":"tab-companies",children:[a.jsx(no,{className:"h-4 w-4 mr-2"}),"Empresas"]}),a.jsxs(Cn,{value:"agents","data-testid":"tab-agents",children:[a.jsx(ss,{className:"h-4 w-4 mr-2"}),"Proxies"]}),q?.serverRole==="server_admin"&&a.jsxs(Cn,{value:"admins","data-testid":"tab-admins",children:[a.jsx(_x,{className:"h-4 w-4 mr-2"}),e.menu.superAdmin,"s"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative",children:[a.jsx(ra,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(Ne,{placeholder:"Buscar...",value:p,onChange:oe=>g(oe.target.value),className:"pl-8 w-64","data-testid":"input-search"})]}),a.jsxs(sr,{open:n,onOpenChange:oe=>{i(oe),oe||Ze()},children:[a.jsx(Qs,{asChild:!0,children:a.jsxs(se,{"data-testid":"button-create-company",children:[a.jsx(cs,{className:"h-4 w-4 mr-2"}),"Nova Empresa"]})}),a.jsxs(Qt,{className:"max-w-2xl max-h-[90vh]",children:[a.jsx(Zt,{children:a.jsx(Jt,{children:"Criar Nova Empresa"})}),a.jsx(Bd,{className:"max-h-[70vh] pr-4",children:a.jsx(CPe,{...be,children:a.jsxs("form",{onSubmit:be.handleSubmit(Ce),className:"space-y-4",children:[a.jsx(ic,{control:be.control,name:"name",render:({field:oe})=>a.jsxs(nl,{children:[a.jsx(il,{children:"Nome da Empresa"}),a.jsx(sl,{children:a.jsx(Ne,{...oe,placeholder:"Acme Corp","data-testid":"input-company-name"})}),a.jsx(al,{})]})}),a.jsx(ic,{control:be.control,name:"slug",render:({field:oe})=>a.jsxs(nl,{children:[a.jsx(il,{children:"Slug (identificador unico)"}),a.jsx(sl,{children:a.jsx(Ne,{...oe,placeholder:"acme-corp","data-testid":"input-company-slug"})}),a.jsx(al,{})]})}),a.jsx(ic,{control:be.control,name:"description",render:({field:oe})=>a.jsxs(nl,{children:[a.jsx(il,{children:"Descricao"}),a.jsx(sl,{children:a.jsx(Ne,{...oe,placeholder:"Descricao opcional","data-testid":"input-company-description"})}),a.jsx(al,{})]})}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsx(ic,{control:be.control,name:"maxUsers",render:({field:oe})=>a.jsxs(nl,{children:[a.jsx(il,{children:"Max Usuarios"}),a.jsx(sl,{children:a.jsx(Ne,{type:"number",...oe,onChange:Bt=>oe.onChange(parseInt(Bt.target.value)),"data-testid":"input-max-users"})}),a.jsx(al,{})]})}),a.jsx(ic,{control:be.control,name:"maxEquipment",render:({field:oe})=>a.jsxs(nl,{children:[a.jsx(il,{children:"Max Equipam."}),a.jsx(sl,{children:a.jsx(Ne,{type:"number",...oe,onChange:Bt=>oe.onChange(parseInt(Bt.target.value)),"data-testid":"input-max-equipment"})}),a.jsx(al,{})]})}),a.jsx(ic,{control:be.control,name:"maxAgents",render:({field:oe})=>a.jsxs(nl,{children:[a.jsx(il,{children:"Max Agentes"}),a.jsx(sl,{children:a.jsx(Ne,{type:"number",...oe,onChange:Bt=>oe.onChange(parseInt(Bt.target.value)),"data-testid":"input-max-agents"})}),a.jsx(al,{})]})})]}),a.jsx(ic,{control:be.control,name:"active",render:({field:oe})=>a.jsxs(nl,{className:"flex items-center gap-3",children:[a.jsx(sl,{children:a.jsx(_o,{checked:oe.value,onCheckedChange:oe.onChange,"data-testid":"switch-active"})}),a.jsx(il,{className:"!mt-0",children:"Empresa Ativa"}),a.jsx(al,{})]})}),a.jsx(N7,{className:"my-4"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:"Proxies Iniciais"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Adicione proxies para a empresa (opcional). Voce pode adicionar mais proxies depois."})]}),a.jsxs(Qe,{variant:"outline",children:[v.length," proxy(s)"]})]}),v.length>0&&a.jsx("div",{className:"space-y-2",children:v.map((oe,Bt)=>a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[a.jsx(ss,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-medium text-sm truncate",children:oe.name}),a.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[a.jsx(GX,{className:"h-3 w-3 inline mr-1"}),oe.siteName,oe.ipAddress&&` - ${oe.ipAddress}`]})]}),a.jsx(se,{type:"button",variant:"ghost",size:"icon",onClick:()=>Fe(Bt),"data-testid":`button-remove-proxy-${Bt}`,children:a.jsx(Er,{className:"h-4 w-4 text-destructive"})})]},Bt))}),a.jsx(Ue,{className:"border-dashed",children:a.jsxs(We,{className:"pt-4 space-y-3",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",children:"Nome do Proxy"}),a.jsx(Ne,{value:y.name,onChange:oe=>_({...y,name:oe.target.value}),placeholder:"Proxy Matriz","data-testid":"input-proxy-name"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",children:"Nome do Site/Local"}),a.jsx(Ne,{value:y.siteName,onChange:oe=>_({...y,siteName:oe.target.value}),placeholder:"Matriz Sao Paulo","data-testid":"input-proxy-site"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",children:"IP do Proxy (opcional)"}),a.jsx(Ne,{value:y.ipAddress,onChange:oe=>_({...y,ipAddress:oe.target.value}),placeholder:"192.168.1.100","data-testid":"input-proxy-ip"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",children:"Descricao (opcional)"}),a.jsx(Ne,{value:y.description,onChange:oe=>_({...y,description:oe.target.value}),placeholder:"Proxy principal da matriz","data-testid":"input-proxy-description"})]})]}),a.jsxs(se,{type:"button",variant:"outline",size:"sm",onClick:he,disabled:!y.name||!y.siteName,className:"w-full","data-testid":"button-add-proxy",children:[a.jsx(cs,{className:"h-4 w-4 mr-2"}),"Adicionar Proxy"]})]})})]}),a.jsx(En,{className:"pt-4",children:a.jsx(se,{type:"submit",disabled:z.isPending,"data-testid":"button-submit-company",children:z.isPending?"Criando...":`Criar Empresa${v.length>0?` com ${v.length} proxy(s)`:""}`})})]})})})]})]})]})]}),a.jsx(jn,{value:"companies",className:"space-y-4",children:L?a.jsx(Ue,{children:a.jsx(We,{className:"py-8 text-center text-muted-foreground",children:"Carregando empresas..."})}):Tt?.length===0?a.jsx(Ue,{children:a.jsx(We,{className:"py-8 text-center text-muted-foreground",children:"Nenhuma empresa encontrada"})}):a.jsx("div",{className:"grid gap-4",children:Tt?.map(oe=>a.jsx(Ue,{className:"hover-elevate","data-testid":`card-company-${oe.id}`,children:a.jsx(We,{className:"py-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:a.jsx(no,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"font-semibold",children:oe.name}),a.jsx(Qe,{variant:oe.active?"default":"secondary",className:"text-xs",children:oe.active?"Ativa":"Inativa"})]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:oe.slug})]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"text-right text-sm",children:[a.jsxs("p",{children:[a.jsx(hc,{className:"h-3 w-3 inline mr-1"}),oe.maxUsers," usuarios"]}),a.jsxs("p",{className:"text-muted-foreground",children:[oe.maxEquipment," equipamentos"]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(se,{variant:"ghost",size:"icon",onClick:()=>{H(oe),M(!0)},"data-testid":`button-edit-company-${oe.id}`,children:a.jsx(Za,{className:"h-4 w-4"})}),a.jsxs(is,{children:[a.jsx(js,{asChild:!0,children:a.jsx(se,{variant:"ghost",size:"icon","data-testid":`button-delete-company-${oe.id}`,children:a.jsx(Er,{className:"h-4 w-4 text-destructive"})})}),a.jsxs(Mi,{children:[a.jsxs(Di,{children:[a.jsx(Ii,{children:"Excluir Empresa"}),a.jsxs(Li,{children:['Tem certeza que deseja excluir a empresa "',oe.name,'"? Esta acao nao pode ser desfeita e todos os dados associados serao perdidos.']})]}),a.jsxs(Ri,{children:[a.jsx(Fi,{children:"Cancelar"}),a.jsx(Bi,{onClick:()=>ee.mutate(oe.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})]}),a.jsx(se,{variant:"ghost",size:"icon",children:a.jsx(uo,{className:"h-4 w-4"})})]})]})]})})},oe.id))})}),a.jsx(jn,{value:"agents",className:"space-y-4",children:U?a.jsx(Ue,{children:a.jsx(We,{className:"py-8 text-center text-muted-foreground",children:"Carregando proxies..."})}):Ct?.length===0?a.jsx(Ue,{children:a.jsx(We,{className:"py-8 text-center text-muted-foreground",children:"Nenhum proxy encontrado"})}):a.jsx("div",{className:"grid gap-4",children:Ct?.map(oe=>a.jsx(Ue,{"data-testid":`card-agent-${oe.id}`,children:a.jsx(We,{className:"py-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:`p-2 rounded-lg ${oe.status==="online"?"bg-green-500/10":"bg-red-500/10"}`,children:a.jsx(ss,{className:`h-5 w-5 ${oe.status==="online"?"text-green-500":"text-red-500"}`})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"font-semibold",children:oe.name}),a.jsx(Qe,{variant:oe.status==="online"?"default":"destructive",className:"text-xs",children:oe.status})]}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:[oe.siteName," ",oe.companyName&&`- ${oe.companyName}`]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(se,{variant:"outline",size:"sm",onClick:()=>Z.mutate(oe.id),disabled:Z.isPending,"data-testid":`button-restart-agent-${oe.id}`,children:[a.jsx(bc,{className:"h-3 w-3 mr-1"}),"Reiniciar"]}),a.jsxs(se,{variant:"outline",size:"sm","data-testid":`button-maintenance-agent-${oe.id}`,children:[a.jsx($g,{className:"h-3 w-3 mr-1"}),"Manutencao"]})]})]})})},oe.id))})}),q?.serverRole==="server_admin"&&a.jsxs(jn,{value:"admins",className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h2",{className:"text-lg font-semibold",children:[e.menu.superAdmin,"s"]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Somente Super Administradores podem gerenciar outros Super Administradores"})]}),a.jsxs(sr,{open:s,onOpenChange:o,children:[a.jsx(Qs,{asChild:!0,children:a.jsxs(se,{"data-testid":"button-create-admin",children:[a.jsx(OE,{className:"h-4 w-4 mr-2"}),"Novo ",e.menu.superAdmin]})}),a.jsxs(Qt,{children:[a.jsx(Zt,{children:a.jsxs(Jt,{children:["Adicionar ",e.menu.superAdmin]})}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Usuario"}),a.jsxs(ar,{value:S,onValueChange:j,children:[a.jsx(er,{"data-testid":"select-admin-user",children:a.jsx(or,{placeholder:"Selecione um usuario"})}),a.jsx(tr,{children:B?.filter(oe=>!W?.some(Bt=>Bt.userId===oe.id)).map(oe=>a.jsxs(tt,{value:oe.id.toString(),children:[oe.username," ",oe.email?`(${oe.email})`:""]},oe.id))})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Funcao"}),a.jsxs(ar,{value:E,onValueChange:P,children:[a.jsx(er,{"data-testid":"select-admin-role",children:a.jsx(or,{placeholder:"Selecione a funcao"})}),a.jsxs(tr,{children:[a.jsx(tt,{value:"server_admin",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(F_,{className:"h-4 w-4 text-amber-500"}),"Super Administrador"]})}),a.jsx(tt,{value:"support_engineer",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($g,{className:"h-4 w-4"}),"Engenheiro de Suporte"]})})]})]})]})]}),a.jsx(En,{children:a.jsx(se,{onClick:()=>{S&&ae.mutate({userId:parseInt(S),role:E})},disabled:!S||ae.isPending,"data-testid":"button-submit-admin",children:ae.isPending?"Criando...":"Adicionar"})})]})]}),a.jsx(sr,{open:l,onOpenChange:u,children:a.jsxs(Qt,{children:[a.jsx(Zt,{children:a.jsx(Jt,{children:"Editar Administrador"})}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Usuario"}),a.jsx(Ne,{value:d?.username||`User #${d?.userId}`,disabled:!0,className:"bg-muted"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Funcao"}),a.jsxs(ar,{value:C,onValueChange:N,children:[a.jsx(er,{"data-testid":"select-edit-admin-role",children:a.jsx(or,{placeholder:"Selecione a funcao"})}),a.jsxs(tr,{children:[a.jsx(tt,{value:"server_admin",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(F_,{className:"h-4 w-4 text-amber-500"}),"Super Administrador"]})}),a.jsx(tt,{value:"support_engineer",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($g,{className:"h-4 w-4"}),"Engenheiro de Suporte"]})})]})]})]})]}),a.jsxs(En,{children:[a.jsx(se,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),a.jsx(se,{onClick:()=>{d&&re.mutate({adminId:d.id,role:C})},disabled:!C||re.isPending,"data-testid":"button-update-admin",children:re.isPending?"Salvando...":"Salvar"})]})]})})]}),V?a.jsx(Ue,{children:a.jsx(We,{className:"py-8 text-center text-muted-foreground",children:"Carregando administradores..."})}):W?.length===0?a.jsx(Ue,{children:a.jsx(We,{className:"py-8 text-center text-muted-foreground",children:"Nenhum administrador encontrado"})}):a.jsx("div",{className:"grid gap-4",children:W?.map(oe=>a.jsx(Ue,{"data-testid":`card-admin-${oe.id}`,children:a.jsx(We,{className:"py-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:`p-2 rounded-lg ${oe.role==="server_admin"?"bg-amber-500/10":"bg-primary/10"}`,children:oe.role==="server_admin"?a.jsx(F_,{className:"h-5 w-5 text-amber-500"}):a.jsx($g,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"font-semibold",children:oe.username||`User #${oe.userId}`}),a.jsx(Qe,{variant:oe.role==="server_admin"?"default":"secondary",className:oe.role==="server_admin"?"bg-amber-500 text-white":"",children:oe.role==="server_admin"?e.menu.superAdmin:"Engenheiro de Suporte"})]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:oe.email||""})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(se,{variant:"outline",size:"sm",onClick:()=>ie(oe),"data-testid":`button-edit-admin-${oe.id}`,children:[a.jsx(Za,{className:"h-3 w-3 mr-1"}),"Editar"]}),a.jsxs(is,{children:[a.jsx(js,{asChild:!0,children:a.jsxs(se,{variant:"destructive",size:"sm","data-testid":`button-delete-admin-${oe.id}`,children:[a.jsx(Er,{className:"h-3 w-3 mr-1"}),"Remover"]})}),a.jsxs(Mi,{children:[a.jsxs(Di,{children:[a.jsx(Ii,{children:"Remover administrador?"}),a.jsxs(Li,{children:["Esta acao ira remover os privilegios de administrador de ",oe.username||`User #${oe.userId}`,". Esta acao nao pode ser desfeita."]})]}),a.jsxs(Ri,{children:[a.jsx(Fi,{children:"Cancelar"}),a.jsx(Bi,{onClick:()=>K.mutate(oe.id),className:"bg-destructive text-destructive-foreground",children:"Remover"})]})]})]})]})]})})},oe.id))})]})]})]}),a.jsx(sr,{open:T,onOpenChange:M,children:a.jsxs(Qt,{className:"max-w-md",children:[a.jsx(Zt,{children:a.jsx(Jt,{children:"Editar Empresa"})}),R&&a.jsx(OPe,{company:R,onSave:oe=>ve.mutate({id:R.id,updates:oe}),onCancel:()=>{M(!1),H(null)},isPending:ve.isPending})]})})]}):a.jsxs("div",{className:"flex flex-col h-full items-center justify-center gap-4 p-6",children:[a.jsx("div",{className:"p-4 rounded-full bg-destructive/10",children:a.jsx(JX,{className:"h-12 w-12 text-destructive"})}),a.jsxs("h1",{className:"text-xl font-bold",children:[e.common.error,": Acesso Negado"]}),a.jsx("p",{className:"text-muted-foreground text-center max-w-md",children:"Esta area e restrita a Super Administradores do NBM CLOUD. Somente usuarios com privilegios de Super Administrador podem acessar o NBM CLOUD Server."}),a.jsx(se,{onClick:()=>r("/"),"data-testid":"button-go-home",children:"Voltar ao Inicio"})]})}function OPe({company:e,onSave:t,onCancel:r,isPending:n}){const[i,s]=b.useState(e.name),[o,l]=b.useState(e.description||""),[u,d]=b.useState(e.maxUsers??10),[f,p]=b.useState(e.maxEquipment??100),[g,v]=b.useState(e.maxAgents??5),[x,y]=b.useState(e.active??!0),_=S=>{S.preventDefault(),t({name:i,description:o,maxUsers:u,maxEquipment:f,maxAgents:g,active:x})};return a.jsxs("form",{onSubmit:_,className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Nome"}),a.jsx(Ne,{value:i,onChange:S=>s(S.target.value),"data-testid":"input-edit-company-name"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Descricao"}),a.jsx(qc,{value:o,onChange:S=>l(S.target.value),"data-testid":"input-edit-company-description"})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Max Usuarios"}),a.jsx(Ne,{type:"number",value:u,onChange:S=>d(parseInt(S.target.value)||0),"data-testid":"input-edit-company-max-users"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Max Equipam."}),a.jsx(Ne,{type:"number",value:f,onChange:S=>p(parseInt(S.target.value)||0),"data-testid":"input-edit-company-max-equipment"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium",children:"Max Agentes"}),a.jsx(Ne,{type:"number",value:g,onChange:S=>v(parseInt(S.target.value)||0),"data-testid":"input-edit-company-max-agents"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(_o,{checked:x,onCheckedChange:y,"data-testid":"switch-edit-company-active"}),a.jsx("label",{className:"text-sm font-medium",children:"Empresa Ativa"})]}),a.jsxs(En,{children:[a.jsx(se,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),a.jsx(se,{type:"submit",disabled:n,"data-testid":"button-save-company",children:n?"Salvando...":"Salvar"})]})]})}var yE=["Enter"," "],MPe=["ArrowDown","PageUp","Home"],P7=["ArrowUp","PageDown","End"],DPe=[...MPe,...P7],RPe={ltr:[...yE,"ArrowRight"],rtl:[...yE,"ArrowLeft"]},IPe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},jm="Menu",[Wp,LPe,BPe]=vx(jm),[Jc,A7]=ei(jm,[BPe,Ol,Ib]),Ub=Ol(),T7=Ib(),[FPe,eu]=Jc(jm),[$Pe,km]=Jc(jm),O7=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:i,onOpenChange:s,modal:o=!0}=e,l=Ub(t),[u,d]=b.useState(null),f=b.useRef(!1),p=Hr(s),g=Qp(i);return b.useEffect(()=>{const v=()=>{f.current=!0,document.addEventListener("pointerdown",x,{capture:!0,once:!0}),document.addEventListener("pointermove",x,{capture:!0,once:!0})},x=()=>f.current=!1;return document.addEventListener("keydown",v,{capture:!0}),()=>{document.removeEventListener("keydown",v,{capture:!0}),document.removeEventListener("pointerdown",x,{capture:!0}),document.removeEventListener("pointermove",x,{capture:!0})}},[]),a.jsx(jx,{...l,children:a.jsx(FPe,{scope:t,open:r,onOpenChange:p,content:u,onContentChange:d,children:a.jsx($Pe,{scope:t,onClose:b.useCallback(()=>p(!1),[p]),isUsingKeyboardRef:f,dir:g,modal:o,children:n})})})};O7.displayName=jm;var qPe="MenuAnchor",BP=b.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,i=Ub(r);return a.jsx(Xp,{...i,...n,ref:t})});BP.displayName=qPe;var FP="MenuPortal",[zPe,M7]=Jc(FP,{forceMount:void 0}),D7=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:i}=e,s=eu(FP,t);return a.jsx(zPe,{scope:t,forceMount:r,children:a.jsx(An,{present:r||s.open,children:a.jsx(Ud,{asChild:!0,container:i,children:n})})})};D7.displayName=FP;var Ps="MenuContent",[UPe,$P]=Jc(Ps),R7=b.forwardRef((e,t)=>{const r=M7(Ps,e.__scopeMenu),{forceMount:n=r.forceMount,...i}=e,s=eu(Ps,e.__scopeMenu),o=km(Ps,e.__scopeMenu);return a.jsx(Wp.Provider,{scope:e.__scopeMenu,children:a.jsx(An,{present:n||s.open,children:a.jsx(Wp.Slot,{scope:e.__scopeMenu,children:o.modal?a.jsx(WPe,{...i,ref:t}):a.jsx(HPe,{...i,ref:t})})})})}),WPe=b.forwardRef((e,t)=>{const r=eu(Ps,e.__scopeMenu),n=b.useRef(null),i=St(t,n);return b.useEffect(()=>{const s=n.current;if(s)return Mx(s)},[]),a.jsx(qP,{...e,ref:i,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Oe(e.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),HPe=b.forwardRef((e,t)=>{const r=eu(Ps,e.__scopeMenu);return a.jsx(qP,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),VPe=xl("MenuContent.ScrollLock"),qP=b.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:u,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:p,onInteractOutside:g,onDismiss:v,disableOutsideScroll:x,...y}=e,_=eu(Ps,r),S=km(Ps,r),j=Ub(r),E=T7(r),P=LPe(r),[C,N]=b.useState(null),T=b.useRef(null),M=St(t,T,_.onContentChange),R=b.useRef(0),H=b.useRef(""),q=b.useRef(0),D=b.useRef(null),I=b.useRef("right"),O=b.useRef(0),F=x?Jp:b.Fragment,L=x?{as:VPe,allowPinchZoom:!0}:void 0,Y=W=>{const V=H.current+W,B=P().filter(ee=>!ee.disabled),z=document.activeElement,Z=B.find(ee=>ee.ref.current===z)?.textValue,ae=B.map(ee=>ee.textValue),K=iAe(ae,V,Z),re=B.find(ee=>ee.textValue===K)?.ref.current;(function ee(ve){H.current=ve,window.clearTimeout(R.current),ve!==""&&(R.current=window.setTimeout(()=>ee(""),1e3))})(V),re&&setTimeout(()=>re.focus())};b.useEffect(()=>()=>window.clearTimeout(R.current),[]),Ox();const U=b.useCallback(W=>I.current===D.current?.side&&aAe(W,D.current?.area),[]);return a.jsx(UPe,{scope:r,searchRef:H,onItemEnter:b.useCallback(W=>{U(W)&&W.preventDefault()},[U]),onItemLeave:b.useCallback(W=>{U(W)||(T.current?.focus(),N(null))},[U]),onTriggerLeave:b.useCallback(W=>{U(W)&&W.preventDefault()},[U]),pointerGraceTimerRef:q,onPointerGraceIntentChange:b.useCallback(W=>{D.current=W},[]),children:a.jsx(F,{...L,children:a.jsx(Zp,{asChild:!0,trapped:i,onMountAutoFocus:Oe(s,W=>{W.preventDefault(),T.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:a.jsx(Hc,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:p,onInteractOutside:g,onDismiss:v,children:a.jsx(z9,{asChild:!0,...E,dir:S.dir,orientation:"vertical",loop:n,currentTabStopId:C,onCurrentTabStopIdChange:N,onEntryFocus:Oe(u,W=>{S.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:a.jsx(kx,{role:"menu","aria-orientation":"vertical","data-state":Q7(_.open),"data-radix-menu-content":"",dir:S.dir,...j,...y,ref:M,style:{outline:"none",...y.style},onKeyDown:Oe(y.onKeyDown,W=>{const B=W.target.closest("[data-radix-menu-content]")===W.currentTarget,z=W.ctrlKey||W.altKey||W.metaKey,Z=W.key.length===1;B&&(W.key==="Tab"&&W.preventDefault(),!z&&Z&&Y(W.key));const ae=T.current;if(W.target!==ae||!DPe.includes(W.key))return;W.preventDefault();const re=P().filter(ee=>!ee.disabled).map(ee=>ee.ref.current);P7.includes(W.key)&&re.reverse(),rAe(re)}),onBlur:Oe(e.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(R.current),H.current="")}),onPointerMove:Oe(e.onPointerMove,Hp(W=>{const V=W.target,B=O.current!==W.clientX;if(W.currentTarget.contains(V)&&B){const z=W.clientX>O.current?"right":"left";I.current=z,O.current=W.clientX}}))})})})})})})});R7.displayName=Ps;var KPe="MenuGroup",zP=b.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(Ke.div,{role:"group",...n,ref:t})});zP.displayName=KPe;var GPe="MenuLabel",I7=b.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(Ke.div,{...n,ref:t})});I7.displayName=GPe;var fx="MenuItem",h3="menu.itemSelect",Wb=b.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...i}=e,s=b.useRef(null),o=km(fx,e.__scopeMenu),l=$P(fx,e.__scopeMenu),u=St(t,s),d=b.useRef(!1),f=()=>{const p=s.current;if(!r&&p){const g=new CustomEvent(h3,{bubbles:!0,cancelable:!0});p.addEventListener(h3,v=>n?.(v),{once:!0}),kE(p,g),g.defaultPrevented?d.current=!1:o.onClose()}};return a.jsx(L7,{...i,ref:u,disabled:r,onClick:Oe(e.onClick,f),onPointerDown:p=>{e.onPointerDown?.(p),d.current=!0},onPointerUp:Oe(e.onPointerUp,p=>{d.current||p.currentTarget?.click()}),onKeyDown:Oe(e.onKeyDown,p=>{const g=l.searchRef.current!=="";r||g&&p.key===" "||yE.includes(p.key)&&(p.currentTarget.click(),p.preventDefault())})})});Wb.displayName=fx;var L7=b.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:i,...s}=e,o=$P(fx,r),l=T7(r),u=b.useRef(null),d=St(t,u),[f,p]=b.useState(!1),[g,v]=b.useState("");return b.useEffect(()=>{const x=u.current;x&&v((x.textContent??"").trim())},[s.children]),a.jsx(Wp.ItemSlot,{scope:r,disabled:n,textValue:i??g,children:a.jsx(U9,{asChild:!0,...l,focusable:!n,children:a.jsx(Ke.div,{role:"menuitem","data-highlighted":f?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...s,ref:d,onPointerMove:Oe(e.onPointerMove,Hp(x=>{n?o.onItemLeave(x):(o.onItemEnter(x),x.defaultPrevented||x.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Oe(e.onPointerLeave,Hp(x=>o.onItemLeave(x))),onFocus:Oe(e.onFocus,()=>p(!0)),onBlur:Oe(e.onBlur,()=>p(!1))})})})}),YPe="MenuCheckboxItem",B7=b.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...i}=e;return a.jsx(U7,{scope:e.__scopeMenu,checked:r,children:a.jsx(Wb,{role:"menuitemcheckbox","aria-checked":px(r)?"mixed":r,...i,ref:t,"data-state":WP(r),onSelect:Oe(i.onSelect,()=>n?.(px(r)?!0:!r),{checkForDefaultPrevented:!1})})})});B7.displayName=YPe;var F7="MenuRadioGroup",[XPe,QPe]=Jc(F7,{value:void 0,onValueChange:()=>{}}),$7=b.forwardRef((e,t)=>{const{value:r,onValueChange:n,...i}=e,s=Hr(n);return a.jsx(XPe,{scope:e.__scopeMenu,value:r,onValueChange:s,children:a.jsx(zP,{...i,ref:t})})});$7.displayName=F7;var q7="MenuRadioItem",z7=b.forwardRef((e,t)=>{const{value:r,...n}=e,i=QPe(q7,e.__scopeMenu),s=r===i.value;return a.jsx(U7,{scope:e.__scopeMenu,checked:s,children:a.jsx(Wb,{role:"menuitemradio","aria-checked":s,...n,ref:t,"data-state":WP(s),onSelect:Oe(n.onSelect,()=>i.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});z7.displayName=q7;var UP="MenuItemIndicator",[U7,ZPe]=Jc(UP,{checked:!1}),W7=b.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...i}=e,s=ZPe(UP,r);return a.jsx(An,{present:n||px(s.checked)||s.checked===!0,children:a.jsx(Ke.span,{...i,ref:t,"data-state":WP(s.checked)})})});W7.displayName=UP;var JPe="MenuSeparator",H7=b.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(Ke.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});H7.displayName=JPe;var eAe="MenuArrow",V7=b.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,i=Ub(r);return a.jsx(Ex,{...i,...n,ref:t})});V7.displayName=eAe;var tAe="MenuSub",[RTe,K7]=Jc(tAe),Ef="MenuSubTrigger",G7=b.forwardRef((e,t)=>{const r=eu(Ef,e.__scopeMenu),n=km(Ef,e.__scopeMenu),i=K7(Ef,e.__scopeMenu),s=$P(Ef,e.__scopeMenu),o=b.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:u}=s,d={__scopeMenu:e.__scopeMenu},f=b.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return b.useEffect(()=>f,[f]),b.useEffect(()=>{const p=l.current;return()=>{window.clearTimeout(p),u(null)}},[l,u]),a.jsx(BP,{asChild:!0,...d,children:a.jsx(L7,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":i.contentId,"data-state":Q7(r.open),...e,ref:co(t,i.onTriggerChange),onClick:p=>{e.onClick?.(p),!(e.disabled||p.defaultPrevented)&&(p.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Oe(e.onPointerMove,Hp(p=>{s.onItemEnter(p),!p.defaultPrevented&&!e.disabled&&!r.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{r.onOpenChange(!0),f()},100))})),onPointerLeave:Oe(e.onPointerLeave,Hp(p=>{f();const g=r.content?.getBoundingClientRect();if(g){const v=r.content?.dataset.side,x=v==="right",y=x?-5:5,_=g[x?"left":"right"],S=g[x?"right":"left"];s.onPointerGraceIntentChange({area:[{x:p.clientX+y,y:p.clientY},{x:_,y:g.top},{x:S,y:g.top},{x:S,y:g.bottom},{x:_,y:g.bottom}],side:v}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(p),p.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:Oe(e.onKeyDown,p=>{const g=s.searchRef.current!=="";e.disabled||g&&p.key===" "||RPe[n.dir].includes(p.key)&&(r.onOpenChange(!0),r.content?.focus(),p.preventDefault())})})})});G7.displayName=Ef;var Y7="MenuSubContent",X7=b.forwardRef((e,t)=>{const r=M7(Ps,e.__scopeMenu),{forceMount:n=r.forceMount,...i}=e,s=eu(Ps,e.__scopeMenu),o=km(Ps,e.__scopeMenu),l=K7(Y7,e.__scopeMenu),u=b.useRef(null),d=St(t,u);return a.jsx(Wp.Provider,{scope:e.__scopeMenu,children:a.jsx(An,{present:n||s.open,children:a.jsx(Wp.Slot,{scope:e.__scopeMenu,children:a.jsx(qP,{id:l.contentId,"aria-labelledby":l.triggerId,...i,ref:d,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:f=>{o.isUsingKeyboardRef.current&&u.current?.focus(),f.preventDefault()},onCloseAutoFocus:f=>f.preventDefault(),onFocusOutside:Oe(e.onFocusOutside,f=>{f.target!==l.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:Oe(e.onEscapeKeyDown,f=>{o.onClose(),f.preventDefault()}),onKeyDown:Oe(e.onKeyDown,f=>{const p=f.currentTarget.contains(f.target),g=IPe[o.dir].includes(f.key);p&&g&&(s.onOpenChange(!1),l.trigger?.focus(),f.preventDefault())})})})})})});X7.displayName=Y7;function Q7(e){return e?"open":"closed"}function px(e){return e==="indeterminate"}function WP(e){return px(e)?"indeterminate":e?"checked":"unchecked"}function rAe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function nAe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function iAe(e,t,r){const i=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,s=r?e.indexOf(r):-1;let o=nAe(e,Math.max(s,0));i.length===1&&(o=o.filter(d=>d!==r));const u=o.find(d=>d.toLowerCase().startsWith(i.toLowerCase()));return u!==r?u:void 0}function sAe(e,t){const{x:r,y:n}=e;let i=!1;for(let s=0,o=t.length-1;s<t.length;o=s++){const l=t[s].x,u=t[s].y,d=t[o].x,f=t[o].y;u>n!=f>n&&r<(d-l)*(n-u)/(f-u)+l&&(i=!i)}return i}function aAe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return sAe(r,t)}function Hp(e){return t=>t.pointerType==="mouse"?e(t):void 0}var oAe=O7,lAe=BP,cAe=D7,uAe=R7,dAe=zP,hAe=I7,fAe=Wb,pAe=B7,mAe=$7,gAe=z7,vAe=W7,yAe=H7,xAe=V7,bAe=G7,_Ae=X7,HP="DropdownMenu",[wAe]=ei(HP,[A7]),Ci=A7(),[SAe,Z7]=wAe(HP),J7=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:i,defaultOpen:s,onOpenChange:o,modal:l=!0}=e,u=Ci(t),d=b.useRef(null),[f=!1,p]=As({prop:i,defaultProp:s,onChange:o});return a.jsx(SAe,{scope:t,triggerId:Nn(),triggerRef:d,contentId:Nn(),open:f,onOpenChange:p,onOpenToggle:b.useCallback(()=>p(g=>!g),[p]),modal:l,children:a.jsx(oAe,{...u,open:f,onOpenChange:p,dir:n,modal:l,children:r})})};J7.displayName=HP;var eV="DropdownMenuTrigger",tV=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...i}=e,s=Z7(eV,r),o=Ci(r);return a.jsx(lAe,{asChild:!0,...o,children:a.jsx(Ke.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...i,ref:co(t,s.triggerRef),onPointerDown:Oe(e.onPointerDown,l=>{!n&&l.button===0&&l.ctrlKey===!1&&(s.onOpenToggle(),s.open||l.preventDefault())}),onKeyDown:Oe(e.onKeyDown,l=>{n||(["Enter"," "].includes(l.key)&&s.onOpenToggle(),l.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});tV.displayName=eV;var CAe="DropdownMenuPortal",rV=e=>{const{__scopeDropdownMenu:t,...r}=e,n=Ci(t);return a.jsx(cAe,{...n,...r})};rV.displayName=CAe;var nV="DropdownMenuContent",iV=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Z7(nV,r),s=Ci(r),o=b.useRef(!1);return a.jsx(uAe,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...n,ref:t,onCloseAutoFocus:Oe(e.onCloseAutoFocus,l=>{o.current||i.triggerRef.current?.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:Oe(e.onInteractOutside,l=>{const u=l.detail.originalEvent,d=u.button===0&&u.ctrlKey===!0,f=u.button===2||d;(!i.modal||f)&&(o.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});iV.displayName=nV;var jAe="DropdownMenuGroup",kAe=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(dAe,{...i,...n,ref:t})});kAe.displayName=jAe;var EAe="DropdownMenuLabel",sV=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(hAe,{...i,...n,ref:t})});sV.displayName=EAe;var NAe="DropdownMenuItem",aV=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(fAe,{...i,...n,ref:t})});aV.displayName=NAe;var PAe="DropdownMenuCheckboxItem",oV=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(pAe,{...i,...n,ref:t})});oV.displayName=PAe;var AAe="DropdownMenuRadioGroup",TAe=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(mAe,{...i,...n,ref:t})});TAe.displayName=AAe;var OAe="DropdownMenuRadioItem",lV=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(gAe,{...i,...n,ref:t})});lV.displayName=OAe;var MAe="DropdownMenuItemIndicator",cV=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(vAe,{...i,...n,ref:t})});cV.displayName=MAe;var DAe="DropdownMenuSeparator",uV=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(yAe,{...i,...n,ref:t})});uV.displayName=DAe;var RAe="DropdownMenuArrow",IAe=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(xAe,{...i,...n,ref:t})});IAe.displayName=RAe;var LAe="DropdownMenuSubTrigger",dV=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(bAe,{...i,...n,ref:t})});dV.displayName=LAe;var BAe="DropdownMenuSubContent",hV=b.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,i=Ci(r);return a.jsx(_Ae,{...i,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});hV.displayName=BAe;var FAe=J7,$Ae=tV,qAe=rV,fV=iV,pV=sV,mV=aV,gV=oV,vV=lV,yV=cV,xV=uV,bV=dV,_V=hV;const zAe=FAe,UAe=$Ae,WAe=b.forwardRef(({className:e,inset:t,children:r,...n},i)=>a.jsxs(bV,{ref:i,className:ke("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...n,children:[r,a.jsx(uo,{className:"ml-auto"})]}));WAe.displayName=bV.displayName;const HAe=b.forwardRef(({className:e,...t},r)=>a.jsx(_V,{ref:r,className:ke("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",e),...t}));HAe.displayName=_V.displayName;const wV=b.forwardRef(({className:e,sideOffset:t=4,...r},n)=>a.jsx(qAe,{children:a.jsx(fV,{ref:n,sideOffset:t,className:ke("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",e),...r})}));wV.displayName=fV.displayName;const Mv=b.forwardRef(({className:e,inset:t,...r},n)=>a.jsx(mV,{ref:n,className:ke("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...r}));Mv.displayName=mV.displayName;const VAe=b.forwardRef(({className:e,children:t,checked:r,...n},i)=>a.jsxs(gV,{ref:i,className:ke("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...n,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(yV,{children:a.jsx(io,{className:"h-4 w-4"})})}),t]}));VAe.displayName=gV.displayName;const KAe=b.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(vV,{ref:n,className:ke("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(yV,{children:a.jsx(LX,{className:"h-2 w-2 fill-current"})})}),t]}));KAe.displayName=vV.displayName;const GAe=b.forwardRef(({className:e,inset:t,...r},n)=>a.jsx(pV,{ref:n,className:ke("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));GAe.displayName=pV.displayName;const YAe=b.forwardRef(({className:e,...t},r)=>a.jsx(xV,{ref:r,className:ke("-mx-1 my-1 h-px bg-muted",e),...t}));YAe.displayName=xV.displayName;function XAe(){const{toast:e}=pn(),{t}=Tr(),[r,n]=b.useState(!1),[i,s]=b.useState(!1),[o,l]=b.useState(!1),[u,d]=b.useState(!1),[f,p]=b.useState(!1),[g,v]=b.useState(null),[x,y]=b.useState({name:"",slug:"",description:"",active:!0,maxUsers:100,maxEquipment:1e3,maxAgents:50}),[_,S]=b.useState({username:"",role:"admin"}),{data:j=[],isLoading:E}=Pt({queryKey:["/api/companies"]}),{data:P=[]}=Pt({queryKey:["/api/companies",g?.id,"users"],enabled:!!g&&u}),C=st({mutationFn:O=>_t("POST","/api/companies",O),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/companies"]}),n(!1),H(),e({title:"Empresa criada com sucesso"})},onError:O=>{e({title:"Erro ao criar empresa",description:O.message,variant:"destructive"})}}),N=st({mutationFn:O=>_t("PATCH",`/api/companies/${g?.id}`,O),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/companies"]}),s(!1),H(),e({title:"Empresa atualizada com sucesso"})},onError:O=>{e({title:"Erro ao atualizar empresa",description:O.message,variant:"destructive"})}}),T=st({mutationFn:()=>_t("DELETE",`/api/companies/${g?.id}`),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/companies"]}),l(!1),v(null),e({title:"Empresa excluída com sucesso"})},onError:O=>{e({title:"Erro ao excluir empresa",description:O.message,variant:"destructive"})}}),M=st({mutationFn:O=>_t("POST",`/api/companies/${g?.id}/users`,O),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/companies",g?.id,"users"]}),p(!1),S({username:"",role:"admin"}),e({title:"Usuário adicionado com sucesso"})},onError:O=>{e({title:"Erro ao adicionar usuário",description:O.message,variant:"destructive"})}}),R=st({mutationFn:O=>_t("DELETE",`/api/companies/${g?.id}/users/${O}`),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/companies",g?.id,"users"]}),e({title:"Usuário removido com sucesso"})},onError:O=>{e({title:"Erro ao remover usuário",description:O.message,variant:"destructive"})}}),H=()=>{y({name:"",slug:"",description:"",active:!0,maxUsers:100,maxEquipment:1e3,maxAgents:50})},q=O=>{v(O),y({name:O.name,slug:O.slug,description:O.description||"",active:O.active??!0,maxUsers:O.maxUsers??100,maxEquipment:O.maxEquipment??1e3,maxAgents:O.maxAgents??50}),s(!0)},D=O=>{v(O),d(!0)},I=O=>O.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");return a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2","data-testid":"text-page-title",children:[a.jsx(no,{className:"h-6 w-6"}),"Empresas"]}),a.jsx("p",{className:"text-muted-foreground",children:"Gerenciamento de empresas e seus administradores"})]}),a.jsxs(se,{onClick:()=>n(!0),"data-testid":"button-add-company",children:[a.jsx(cs,{className:"h-4 w-4 mr-2"}),"Nova Empresa"]})]}),a.jsxs(Ue,{children:[a.jsxs(bt,{children:[a.jsxs(wt,{className:"flex items-center gap-2",children:[a.jsx(no,{className:"h-5 w-5"}),"Empresas Cadastradas"]}),a.jsx(zt,{children:"Lista de todas as empresas registradas no sistema"})]}),a.jsx(We,{children:E?a.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando..."}):j.length===0?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(no,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"Nenhuma empresa cadastrada"}),a.jsx("p",{className:"text-sm",children:'Clique em "Nova Empresa" para adicionar'})]}):a.jsxs(Qn,{children:[a.jsx(Zn,{children:a.jsxs(It,{children:[a.jsx(De,{children:"Empresa"}),a.jsx(De,{children:"Slug"}),a.jsx(De,{className:"text-center",children:"Status"}),a.jsx(De,{className:"text-center",children:"Limites"}),a.jsx(De,{className:"text-right",children:"Ações"})]})}),a.jsx(Jn,{children:j.map(O=>a.jsxs(It,{"data-testid":`row-company-${O.id}`,children:[a.jsx(Ae,{children:a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:O.name}),O.description&&a.jsx("div",{className:"text-sm text-muted-foreground truncate max-w-xs",children:O.description})]})}),a.jsx(Ae,{children:a.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:O.slug})}),a.jsx(Ae,{className:"text-center",children:a.jsx(Qe,{variant:O.active?"default":"secondary",children:O.active?"Ativa":"Inativa"})}),a.jsx(Ae,{className:"text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-3 text-sm text-muted-foreground",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(hc,{className:"h-3 w-3"}),O.maxUsers]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(vr,{className:"h-3 w-3"}),O.maxEquipment]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(ss,{className:"h-3 w-3"}),O.maxAgents]})]})}),a.jsx(Ae,{className:"text-right",children:a.jsxs(zAe,{children:[a.jsx(UAe,{asChild:!0,children:a.jsx(se,{variant:"ghost",size:"icon","data-testid":`button-company-menu-${O.id}`,children:a.jsx($X,{className:"h-4 w-4"})})}),a.jsxs(wV,{align:"end",children:[a.jsxs(Mv,{onClick:()=>D(O),children:[a.jsx(hc,{className:"h-4 w-4 mr-2"}),"Usuários"]}),a.jsxs(Mv,{onClick:()=>q(O),children:[a.jsx(Za,{className:"h-4 w-4 mr-2"}),"Editar"]}),a.jsxs(Mv,{onClick:()=>{v(O),l(!0)},className:"text-destructive",children:[a.jsx(Er,{className:"h-4 w-4 mr-2"}),"Excluir"]})]})]})})]},O.id))})]})})]}),a.jsx(sr,{open:r,onOpenChange:n,children:a.jsxs(Qt,{children:[a.jsxs(Zt,{children:[a.jsx(Jt,{children:"Nova Empresa"}),a.jsx(ci,{children:"Cadastre uma nova empresa no sistema"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Nome da Empresa"}),a.jsx(Ne,{value:x.name,onChange:O=>{y({...x,name:O.target.value,slug:I(O.target.value)})},placeholder:"Ex: Empresa XYZ","data-testid":"input-company-name"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Slug (identificador único)"}),a.jsx(Ne,{value:x.slug,onChange:O=>y({...x,slug:O.target.value}),placeholder:"empresa-xyz","data-testid":"input-company-slug"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Descrição"}),a.jsx(qc,{value:x.description,onChange:O=>y({...x,description:O.target.value}),placeholder:"Descrição da empresa...","data-testid":"input-company-description"})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Max. Usuários"}),a.jsx(Ne,{type:"number",value:x.maxUsers,onChange:O=>y({...x,maxUsers:parseInt(O.target.value)||0}),"data-testid":"input-max-users"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Max. Equipamentos"}),a.jsx(Ne,{type:"number",value:x.maxEquipment,onChange:O=>y({...x,maxEquipment:parseInt(O.target.value)||0}),"data-testid":"input-max-equipment"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Max. Agentes"}),a.jsx(Ne,{type:"number",value:x.maxAgents,onChange:O=>y({...x,maxAgents:parseInt(O.target.value)||0}),"data-testid":"input-max-agents"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(_o,{checked:x.active,onCheckedChange:O=>y({...x,active:O}),"data-testid":"switch-company-active"}),a.jsx(Me,{children:"Empresa ativa"})]})]}),a.jsxs(En,{children:[a.jsx(se,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),a.jsx(se,{onClick:()=>C.mutate(x),disabled:C.isPending||!x.name||!x.slug,"data-testid":"button-save-company",children:C.isPending?"Salvando...":"Salvar"})]})]})}),a.jsx(sr,{open:i,onOpenChange:s,children:a.jsxs(Qt,{children:[a.jsxs(Zt,{children:[a.jsx(Jt,{children:"Editar Empresa"}),a.jsx(ci,{children:"Atualize as informações da empresa"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Nome da Empresa"}),a.jsx(Ne,{value:x.name,onChange:O=>y({...x,name:O.target.value}),placeholder:"Ex: Empresa XYZ"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Slug"}),a.jsx(Ne,{value:x.slug,onChange:O=>y({...x,slug:O.target.value}),placeholder:"empresa-xyz"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Descrição"}),a.jsx(qc,{value:x.description,onChange:O=>y({...x,description:O.target.value}),placeholder:"Descrição da empresa..."})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Max. Usuários"}),a.jsx(Ne,{type:"number",value:x.maxUsers,onChange:O=>y({...x,maxUsers:parseInt(O.target.value)||0})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Max. Equipamentos"}),a.jsx(Ne,{type:"number",value:x.maxEquipment,onChange:O=>y({...x,maxEquipment:parseInt(O.target.value)||0})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Max. Agentes"}),a.jsx(Ne,{type:"number",value:x.maxAgents,onChange:O=>y({...x,maxAgents:parseInt(O.target.value)||0})})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(_o,{checked:x.active,onCheckedChange:O=>y({...x,active:O})}),a.jsx(Me,{children:"Empresa ativa"})]})]}),a.jsxs(En,{children:[a.jsx(se,{variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),a.jsx(se,{onClick:()=>N.mutate(x),disabled:N.isPending||!x.name||!x.slug,children:N.isPending?"Salvando...":"Salvar"})]})]})}),a.jsx(sr,{open:o,onOpenChange:l,children:a.jsxs(Qt,{children:[a.jsxs(Zt,{children:[a.jsx(Jt,{children:"Excluir Empresa"}),a.jsxs(ci,{children:['Tem certeza que deseja excluir a empresa "',g?.name,'"? Esta ação não pode ser desfeita.']})]}),a.jsxs(En,{children:[a.jsx(se,{variant:"outline",onClick:()=>l(!1),children:"Cancelar"}),a.jsx(se,{variant:"destructive",onClick:()=>T.mutate(),disabled:T.isPending,children:T.isPending?"Excluindo...":"Excluir"})]})]})}),a.jsx(sr,{open:u,onOpenChange:d,children:a.jsxs(Qt,{className:"max-w-2xl",children:[a.jsxs(Zt,{children:[a.jsxs(Jt,{className:"flex items-center gap-2",children:[a.jsx(hc,{className:"h-5 w-5"}),"Usuários de ",g?.name]}),a.jsx(ci,{children:"Gerencie os usuários com acesso a esta empresa"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex justify-end",children:a.jsxs(se,{size:"sm",onClick:()=>p(!0),children:[a.jsx(OE,{className:"h-4 w-4 mr-2"}),"Adicionar Usuário"]})}),P.length===0?a.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[a.jsx(hc,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"Nenhum usuário vinculado"})]}):a.jsxs(Qn,{children:[a.jsx(Zn,{children:a.jsxs(It,{children:[a.jsx(De,{children:"Usuário"}),a.jsx(De,{children:"Função"}),a.jsx(De,{className:"text-center",children:"Padrão"}),a.jsx(De,{className:"text-right",children:"Ações"})]})}),a.jsx(Jn,{children:P.map(O=>a.jsxs(It,{children:[a.jsx(Ae,{children:a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:O.user?.username||`User #${O.userId}`}),O.user?.email&&a.jsx("div",{className:"text-sm text-muted-foreground",children:O.user.email})]})}),a.jsx(Ae,{children:a.jsx(Qe,{variant:O.role==="admin"?"default":"secondary",children:O.role})}),a.jsx(Ae,{className:"text-center",children:O.isDefault&&a.jsx(Qe,{variant:"outline",children:"Padrão"})}),a.jsx(Ae,{className:"text-right",children:a.jsx(se,{variant:"ghost",size:"icon",onClick:()=>R.mutate(O.userId),children:a.jsx(Er,{className:"h-4 w-4 text-destructive"})})})]},O.id))})]})]})]})}),a.jsx(sr,{open:f,onOpenChange:p,children:a.jsxs(Qt,{children:[a.jsxs(Zt,{children:[a.jsx(Jt,{children:"Adicionar Usuário"}),a.jsxs(ci,{children:["Vincule um usuário existente à empresa ",g?.name]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Username (ID Replit)"}),a.jsx(Ne,{value:_.username,onChange:O=>S({..._,username:O.target.value}),placeholder:"Ex: marciovvitor","data-testid":"input-add-user-username"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{children:"Função"}),a.jsxs("select",{className:"w-full h-9 px-3 rounded-md border border-input bg-background",value:_.role,onChange:O=>S({..._,role:O.target.value}),children:[a.jsx("option",{value:"admin",children:"Administrador"}),a.jsx("option",{value:"operator",children:"Operador"}),a.jsx("option",{value:"viewer",children:"Visualizador"})]})]})]}),a.jsxs(En,{children:[a.jsx(se,{variant:"outline",onClick:()=>p(!1),children:"Cancelar"}),a.jsx(se,{onClick:()=>M.mutate(_),disabled:M.isPending||!_.username,children:M.isPending?"Adicionando...":"Adicionar"})]})]})})]})}const QAe=["mikrotik","huawei","cisco","nokia","zte","datacom","datacom-dmos","juniper","generic"];function ZAe(){const[e,t]=b.useState(""),[r,n]=b.useState("all"),[i,s]=b.useState(!1),[o,l]=b.useState(!1),[u,d]=b.useState(null),[f,p]=b.useState(null),[g,v]=b.useState({}),{t:x}=Tr(),{toast:y}=pn(),{data:_=[]}=um(),{data:S=[],isLoading:j}=Pt({queryKey:["/api/credentials"]}),{data:E=[],isLoading:P}=Pt({queryKey:["/api/credential-groups"]}),C=b.useMemo(()=>S.filter(O=>{const F=O.name.toLowerCase().includes(e.toLowerCase())||O.username?.toLowerCase().includes(e.toLowerCase())||O.description?.toLowerCase().includes(e.toLowerCase()),L=r==="all"||O.manufacturer===r;return F&&L}),[S,e,r]),N=st({mutationFn:async O=>(await _t("POST","/api/credentials",O)).json(),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/credentials"]}),s(!1),y({title:"Credencial criada com sucesso"})},onError:O=>{y({title:"Erro ao criar credencial",description:O.message,variant:"destructive"})}}),T=st({mutationFn:async({id:O,data:F})=>(await _t("PUT",`/api/credentials/${O}`,F)).json(),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/credentials"]}),d(null),y({title:"Credencial atualizada com sucesso"})},onError:O=>{y({title:"Erro ao atualizar credencial",description:O.message,variant:"destructive"})}}),M=st({mutationFn:async O=>{await _t("DELETE",`/api/credentials/${O}`)},onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/credentials"]}),y({title:"Credencial excluída"})},onError:O=>{y({title:"Erro ao excluir credencial",description:O.message,variant:"destructive"})}}),R=st({mutationFn:async O=>(await _t("POST","/api/credential-groups",O)).json(),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/credential-groups"]}),l(!1),y({title:"Grupo criado com sucesso"})},onError:O=>{y({title:"Erro ao criar grupo",description:O.message,variant:"destructive"})}}),H=st({mutationFn:async({id:O,data:F})=>(await _t("PUT",`/api/credential-groups/${O}`,F)).json(),onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/credential-groups"]}),p(null),y({title:"Grupo atualizado com sucesso"})},onError:O=>{y({title:"Erro ao atualizar grupo",description:O.message,variant:"destructive"})}}),q=st({mutationFn:async O=>{await _t("DELETE",`/api/credential-groups/${O}`)},onSuccess:()=>{dt.invalidateQueries({queryKey:["/api/credential-groups"]}),y({title:"Grupo excluído"})},onError:O=>{y({title:"Erro ao excluir grupo",description:O.message,variant:"destructive"})}}),D=O=>O&&E.find(L=>L.id===O)?.name||"-",I=O=>_.find(L=>L.value===O)?.label||O;return a.jsxs("div",{className:"p-4 sm:p-6 md:p-8 space-y-6",children:[a.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 page-header",children:a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold flex items-center gap-2",children:[a.jsx(so,{className:"h-6 w-6 sm:h-8 sm:w-8"}),"Cofre de Credenciais"]}),a.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-1",children:"Gerencie credenciais reutilizáveis para seus equipamentos de rede"})]})}),a.jsxs(lh,{defaultValue:"credentials",className:"space-y-4",children:[a.jsxs(Qc,{children:[a.jsxs(Cn,{value:"credentials","data-testid":"tab-credentials",children:[a.jsx(VX,{className:"h-4 w-4 mr-2"}),"Credenciais (",S.length,")"]}),a.jsxs(Cn,{value:"groups","data-testid":"tab-groups",children:[a.jsx(bl,{className:"h-4 w-4 mr-2"}),"Grupos (",E.length,")"]})]}),a.jsxs(jn,{value:"credentials",className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-sm",children:[a.jsx(ra,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(Ne,{placeholder:"Buscar credenciais...",value:e,onChange:O=>t(O.target.value),className:"pl-10","data-testid":"input-search-credentials"})]}),a.jsxs(ar,{value:r,onValueChange:n,children:[a.jsx(er,{className:"w-[180px]","data-testid":"select-filter-manufacturer",children:a.jsx(or,{placeholder:"Fabricante"})}),a.jsxs(tr,{children:[a.jsx(tt,{value:"all",children:"Todos fabricantes"}),QAe.map(O=>a.jsx(tt,{value:O,children:I(O)},O))]})]}),a.jsxs(sr,{open:i,onOpenChange:s,children:[a.jsx(Qs,{asChild:!0,children:a.jsxs(se,{"data-testid":"button-add-credential",children:[a.jsx(cs,{className:"h-4 w-4 mr-2"}),"Nova Credencial"]})}),a.jsxs(Qt,{className:"max-w-[95vw] sm:max-w-md",children:[a.jsx(Zt,{children:a.jsx(Jt,{children:"Nova Credencial"})}),a.jsx(SV,{groups:E,manufacturers:_,onSubmit:O=>N.mutate(O),isLoading:N.isPending})]})]})]}),a.jsx(Ue,{children:a.jsx(We,{className:"p-0",children:a.jsxs(Qn,{children:[a.jsx(Zn,{children:a.jsxs(It,{children:[a.jsx(De,{children:"Nome"}),a.jsx(De,{children:"Usuário"}),a.jsx(De,{children:"Fabricante"}),a.jsx(De,{children:"Grupo"}),a.jsx(De,{children:"Descrição"}),a.jsx(De,{className:"text-right",children:"Ações"})]})}),a.jsx(Jn,{children:j?a.jsx(It,{children:a.jsx(Ae,{colSpan:6,className:"text-center py-8",children:"Carregando..."})}):C.length===0?a.jsx(It,{children:a.jsx(Ae,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"Nenhuma credencial encontrada"})}):C.map(O=>a.jsxs(It,{"data-testid":`row-credential-${O.id}`,children:[a.jsx(Ae,{children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(so,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("span",{className:"font-medium",children:O.name})]})}),a.jsx(Ae,{className:"font-mono text-sm",children:O.username}),a.jsx(Ae,{children:a.jsx(Qe,{variant:"outline",className:"uppercase text-xs",children:I(O.manufacturer||"generic")})}),a.jsx(Ae,{children:D(O.groupId)}),a.jsx(Ae,{className:"text-muted-foreground max-w-[200px] truncate",children:O.description||"-"}),a.jsx(Ae,{className:"text-right",children:a.jsxs("div",{className:"flex items-center justify-end gap-1",children:[a.jsx(se,{variant:"ghost",size:"icon",onClick:()=>d(O.id),"data-testid":`button-edit-credential-${O.id}`,children:a.jsx(Za,{className:"h-4 w-4"})}),a.jsxs(is,{children:[a.jsx(js,{asChild:!0,children:a.jsx(se,{variant:"ghost",size:"icon",className:"text-destructive","data-testid":`button-delete-credential-${O.id}`,children:a.jsx(Er,{className:"h-4 w-4"})})}),a.jsxs(Mi,{children:[a.jsxs(Di,{children:[a.jsx(Ii,{children:"Excluir credencial?"}),a.jsxs(Li,{children:['Tem certeza que deseja excluir a credencial "',O.name,'"? Esta ação não pode ser desfeita.']})]}),a.jsxs(Ri,{children:[a.jsx(Fi,{children:"Cancelar"}),a.jsx(Bi,{onClick:()=>M.mutate(O.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})]})]})})]},O.id))})]})})})]}),a.jsxs(jn,{value:"groups",className:"space-y-4",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs(sr,{open:o,onOpenChange:l,children:[a.jsx(Qs,{asChild:!0,children:a.jsxs(se,{"data-testid":"button-add-group",children:[a.jsx(cs,{className:"h-4 w-4 mr-2"}),"Novo Grupo"]})}),a.jsxs(Qt,{className:"max-w-md",children:[a.jsx(Zt,{children:a.jsx(Jt,{children:"Novo Grupo de Credenciais"})}),a.jsx(CV,{onSubmit:O=>R.mutate(O),isLoading:R.isPending})]})]})}),a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:P?a.jsx(Ue,{className:"col-span-full",children:a.jsx(We,{className:"py-8 text-center",children:"Carregando..."})}):E.length===0?a.jsx(Ue,{className:"col-span-full",children:a.jsx(We,{className:"py-8 text-center text-muted-foreground",children:"Nenhum grupo criado ainda"})}):E.map(O=>{const F=S.filter(L=>L.groupId===O.id).length;return a.jsxs(Ue,{className:"hover-elevate","data-testid":`card-group-${O.id}`,children:[a.jsx(bt,{className:"pb-2",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs(wt,{className:"text-lg flex items-center gap-2",children:[a.jsx(bl,{className:"h-5 w-5"}),O.name]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx(se,{variant:"ghost",size:"icon",onClick:()=>p(O.id),"data-testid":`button-edit-group-${O.id}`,children:a.jsx(Za,{className:"h-4 w-4"})}),a.jsxs(is,{children:[a.jsx(js,{asChild:!0,children:a.jsx(se,{variant:"ghost",size:"icon",className:"text-destructive","data-testid":`button-delete-group-${O.id}`,children:a.jsx(Er,{className:"h-4 w-4"})})}),a.jsxs(Mi,{children:[a.jsxs(Di,{children:[a.jsx(Ii,{children:"Excluir grupo?"}),a.jsxs(Li,{children:['Tem certeza que deseja excluir o grupo "',O.name,'"? As credenciais do grupo não serão excluídas.']})]}),a.jsxs(Ri,{children:[a.jsx(Fi,{children:"Cancelar"}),a.jsx(Bi,{onClick:()=>q.mutate(O.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})]})]})]})}),a.jsxs(We,{children:[a.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:O.description||"Sem descrição"}),a.jsx("div",{className:"flex items-center justify-between text-sm",children:a.jsxs(Qe,{variant:"secondary",children:[F," credencial",F!==1?"ais":""]})})]})]},O.id)})})]})]}),u&&a.jsx(JAe,{credentialId:u,credentials:S,groups:E,manufacturers:_,onClose:()=>d(null),onSubmit:O=>T.mutate({id:u,data:O}),isLoading:T.isPending}),f&&a.jsx(eTe,{groupId:f,groups:E,onClose:()=>p(null),onSubmit:O=>H.mutate({id:f,data:O}),isLoading:H.isPending})]})}function SV({groups:e,manufacturers:t,onSubmit:r,isLoading:n,defaultValues:i}){const[s,o]=b.useState(!1),[l,u]=b.useState(!1),{register:d,handleSubmit:f,setValue:p,watch:g,formState:{errors:v}}=oh({defaultValues:{name:i?.name||"",username:i?.username||"",password:"",enablePassword:"",manufacturer:i?.manufacturer||"generic",model:i?.model||"",description:i?.description||"",groupId:i?.groupId||null}}),x=g("groupId"),y=g("manufacturer");return a.jsxs("form",{onSubmit:f(r),className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"name",children:"Nome *"}),a.jsx(Ne,{id:"name",placeholder:"Ex: Credencial Mikrotik Padrão",...d("name",{required:"Nome obrigatório"}),"data-testid":"input-credential-name"}),v.name&&a.jsx("p",{className:"text-xs text-destructive",children:v.name.message})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"username",children:"Usuário *"}),a.jsx(Ne,{id:"username",placeholder:"admin",...d("username",{required:"Usuário obrigatório"}),"data-testid":"input-credential-username"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"password",children:"Senha *"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ne,{id:"password",type:s?"text":"password",placeholder:i?"••••••••":"Senha",...d("password",{required:i?!1:"Senha obrigatória"}),"data-testid":"input-credential-password"}),a.jsx(se,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full",onClick:()=>o(!s),children:s?a.jsx(lM,{className:"h-4 w-4"}):a.jsx(cl,{className:"h-4 w-4"})})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"enablePassword",children:"Senha Enable (opcional)"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ne,{id:"enablePassword",type:l?"text":"password",placeholder:"Senha de enable/privilege",...d("enablePassword"),"data-testid":"input-credential-enable-password"}),a.jsx(se,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full",onClick:()=>u(!l),children:l?a.jsx(lM,{className:"h-4 w-4"}):a.jsx(cl,{className:"h-4 w-4"})})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"manufacturer",children:"Fabricante"}),a.jsxs(ar,{value:y||"generic",onValueChange:_=>p("manufacturer",_),children:[a.jsx(er,{"data-testid":"select-credential-manufacturer",children:a.jsx(or,{})}),a.jsxs(tr,{children:[t.map(_=>a.jsx(tt,{value:_.value,children:_.label},_.value)),a.jsx(tt,{value:"generic",children:"Genérico"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"model",children:"Modelo (opcional)"}),a.jsx(Ne,{id:"model",placeholder:"Ex: RB1100AHx4",...d("model"),"data-testid":"input-credential-model"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"groupId",children:"Grupo (opcional)"}),a.jsxs(ar,{value:x?.toString()||"none",onValueChange:_=>p("groupId",_==="none"?null:parseInt(_)),children:[a.jsx(er,{"data-testid":"select-credential-group",children:a.jsx(or,{placeholder:"Selecionar grupo"})}),a.jsxs(tr,{children:[a.jsx(tt,{value:"none",children:"Sem grupo"}),e.map(_=>a.jsx(tt,{value:_.id.toString(),children:_.name},_.id))]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"description",children:"Descrição (opcional)"}),a.jsx(Ne,{id:"description",placeholder:"Descrição da credencial",...d("description"),"data-testid":"input-credential-description"})]}),a.jsx(En,{children:a.jsx(se,{type:"submit",disabled:n,"data-testid":"button-save-credential",children:n?"Salvando...":"Salvar"})})]})}function CV({onSubmit:e,isLoading:t,defaultValues:r}){const{register:n,handleSubmit:i,formState:{errors:s}}=oh({defaultValues:{name:r?.name||"",description:r?.description||""}});return a.jsxs("form",{onSubmit:i(e),className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"name",children:"Nome *"}),a.jsx(Ne,{id:"name",placeholder:"Ex: Roteadores Core",...n("name",{required:"Nome obrigatório"}),"data-testid":"input-group-name"}),s.name&&a.jsx("p",{className:"text-xs text-destructive",children:s.name.message})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"description",children:"Descrição (opcional)"}),a.jsx(Ne,{id:"description",placeholder:"Descrição do grupo",...n("description"),"data-testid":"input-group-description"})]}),a.jsx(En,{children:a.jsx(se,{type:"submit",disabled:t,"data-testid":"button-save-group",children:t?"Salvando...":"Salvar"})})]})}function JAe({credentialId:e,credentials:t,groups:r,manufacturers:n,onClose:i,onSubmit:s,isLoading:o}){const l=t.find(u=>u.id===e);return l?a.jsx(sr,{open:!0,onOpenChange:i,children:a.jsxs(Qt,{className:"max-w-md",children:[a.jsx(Zt,{children:a.jsx(Jt,{children:"Editar Credencial"})}),a.jsx(SV,{groups:r,manufacturers:n,onSubmit:s,isLoading:o,defaultValues:l})]})}):null}function eTe({groupId:e,groups:t,onClose:r,onSubmit:n,isLoading:i}){const s=t.find(o=>o.id===e);return s?a.jsx(sr,{open:!0,onOpenChange:r,children:a.jsxs(Qt,{className:"max-w-md",children:[a.jsx(Zt,{children:a.jsx(Jt,{children:"Editar Grupo"})}),a.jsx(CV,{onSubmit:n,isLoading:i,defaultValues:s})]})}):null}async function tTe(e){const t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){const r=await t.text();try{const n=JSON.parse(r);throw new Error(n.message||"Erro ao fazer login")}catch{throw new Error("Erro ao fazer login - use o botao Entrar com Replit")}}return t.json()}async function rTe(e){const t=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){const r=await t.text();try{const n=JSON.parse(r);throw new Error(n.message||"Erro ao registrar")}catch{throw new Error("Registro nao disponivel - use o botao Entrar com Replit")}}return t.json()}async function nTe(){try{const e=await fetch("/api/auth/mode",{credentials:"include"});if(e.ok)return e.json()}catch{}return{standalone:!1}}function iTe(){const{toast:e}=pn(),t=qi(),{t:r}=Tr(),[n,i]=b.useState({username:"",password:""}),[s,o]=b.useState({username:"",password:"",confirmPassword:"",name:"",email:""}),{data:l}=Pt({queryKey:["/api/auth/mode"],queryFn:nTe,staleTime:1/0}),u=l?.standalone??!1,d=st({mutationFn:tTe,onSuccess:x=>{e({title:"Login realizado",description:`Bem-vindo, ${x.user.username}!`}),t.invalidateQueries({queryKey:["/api/auth/user"]}),t.invalidateQueries({queryKey:["/api/server/check-admin"]})},onError:x=>{e({title:"Erro no login",description:x.message,variant:"destructive"})}}),f=st({mutationFn:rTe,onSuccess:x=>{e({title:x.user.isAdmin?"Conta de administrador criada":"Conta criada",description:`Bem-vindo, ${x.user.username}!`}),t.invalidateQueries({queryKey:["/api/auth/user"]}),t.invalidateQueries({queryKey:["/api/server/check-admin"]})},onError:x=>{e({title:"Erro no registro",description:x.message,variant:"destructive"})}}),p=x=>{if(x.preventDefault(),!n.username||!n.password){e({title:"Preencha todos os campos",variant:"destructive"});return}d.mutate(n)},g=x=>{if(x.preventDefault(),!s.username||!s.password){e({title:"Preencha usuario e senha",variant:"destructive"});return}if(s.password!==s.confirmPassword){e({title:"As senhas nao conferem",variant:"destructive"});return}f.mutate({username:s.username,password:s.password,name:s.name||void 0,email:s.email||void 0})},v=()=>{window.location.href="/api/login"};return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-muted/50 p-4",children:a.jsxs("div",{className:"w-full max-w-md",children:[a.jsxs("div",{className:"flex flex-col items-center mb-8",children:[a.jsx("div",{className:"w-16 h-16 rounded-2xl bg-primary flex items-center justify-center mb-4",children:a.jsx(vr,{className:"h-8 w-8 text-primary-foreground"})}),a.jsx("h1",{className:"text-2xl font-bold",children:r.login.title}),a.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:r.login.subtitle})]}),a.jsx(Ue,{children:u?a.jsxs(lh,{defaultValue:"login",children:[a.jsx(bt,{className:"pb-4",children:a.jsxs(Qc,{className:"grid w-full grid-cols-2",children:[a.jsxs(Cn,{value:"login","data-testid":"tab-login",children:[a.jsx(cM,{className:"h-4 w-4 mr-2"}),r.common.connect]}),a.jsxs(Cn,{value:"register","data-testid":"tab-register",children:[a.jsx(OE,{className:"h-4 w-4 mr-2"}),r.common.add]})]})}),a.jsxs(We,{children:[a.jsx(jn,{value:"login",className:"mt-0",children:a.jsxs("form",{onSubmit:p,className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"login-username",children:r.admin.username}),a.jsx(Ne,{id:"login-username","data-testid":"input-login-username",placeholder:r.admin.username,value:n.username,onChange:x=>i({...n,username:x.target.value})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"login-password",children:r.admin.password}),a.jsx(Ne,{id:"login-password","data-testid":"input-login-password",type:"password",placeholder:r.admin.password,value:n.password,onChange:x=>i({...n,password:x.target.value})})]}),a.jsx(se,{type:"submit",className:"w-full","data-testid":"button-login",disabled:d.isPending,children:d.isPending?r.common.loading:r.common.connect})]})}),a.jsx(jn,{value:"register",className:"mt-0",children:a.jsxs("form",{onSubmit:g,className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"register-username",children:"Usuario *"}),a.jsx(Ne,{id:"register-username","data-testid":"input-register-username",placeholder:"Escolha um usuario",value:s.username,onChange:x=>o({...s,username:x.target.value})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"register-name",children:"Nome"}),a.jsx(Ne,{id:"register-name","data-testid":"input-register-name",placeholder:"Seu nome completo",value:s.name,onChange:x=>o({...s,name:x.target.value})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"register-email",children:"E-mail"}),a.jsx(Ne,{id:"register-email","data-testid":"input-register-email",type:"email",placeholder:"seu@email.com",value:s.email,onChange:x=>o({...s,email:x.target.value})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"register-password",children:"Senha *"}),a.jsx(Ne,{id:"register-password","data-testid":"input-register-password",type:"password",placeholder:"Escolha uma senha",value:s.password,onChange:x=>o({...s,password:x.target.value})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Me,{htmlFor:"register-confirm",children:"Confirmar Senha *"}),a.jsx(Ne,{id:"register-confirm","data-testid":"input-register-confirm",type:"password",placeholder:"Repita a senha",value:s.confirmPassword,onChange:x=>o({...s,confirmPassword:x.target.value})})]}),a.jsx(se,{type:"submit",className:"w-full","data-testid":"button-register",disabled:f.isPending,children:f.isPending?"Registrando...":"Criar Conta"}),a.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"O primeiro usuario registrado sera o administrador do sistema."})]})})]})]}):a.jsx(We,{className:"pt-6",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("p",{className:"text-center text-muted-foreground text-sm",children:"Faca login com sua conta Replit para acessar o sistema."}),a.jsxs(se,{onClick:v,className:"w-full",size:"lg","data-testid":"button-replit-login",children:[a.jsx(cM,{className:"h-4 w-4 mr-2"}),"Entrar com Replit"]}),a.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Voce sera redirecionado para a pagina de login do Replit."})]})})}),a.jsx("p",{className:"text-center text-xs text-muted-foreground mt-6",children:"Suporta: Huawei, Mikrotik, Cisco, Nokia, ZTE, Datacom, Juniper"})]})})}function sTe(){return a.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:a.jsx(Ue,{className:"w-full max-w-md mx-4",children:a.jsxs(We,{className:"pt-6",children:[a.jsxs("div",{className:"flex mb-4 gap-2",children:[a.jsx(qf,{className:"h-8 w-8 text-red-500"}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),a.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}const Aj=768;function aTe(){const[e,t]=b.useState(void 0);return b.useEffect(()=>{const r=window.matchMedia(`(max-width: ${Aj-1}px)`),n=()=>{t(window.innerWidth<Aj)};return r.addEventListener("change",n),t(window.innerWidth<Aj),()=>r.removeEventListener("change",n)},[]),!!e}const oTe=Sb,lTe=Cb,jV=b.forwardRef(({className:e,...t},r)=>a.jsx(sh,{className:ke("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));jV.displayName=sh.displayName;const cTe=Wd("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),kV=b.forwardRef(({side:e="right",className:t,children:r,...n},i)=>a.jsxs(lTe,{children:[a.jsx(jV,{}),a.jsxs(ah,{ref:i,className:ke(cTe({side:e}),t),...n,children:[r,a.jsxs(jb,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[a.jsx(nd,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));kV.displayName=ah.displayName;const EV=({className:e,...t})=>a.jsx("div",{className:ke("flex flex-col space-y-2 text-center sm:text-left",e),...t});EV.displayName="SheetHeader";const NV=b.forwardRef(({className:e,...t},r)=>a.jsx(dm,{ref:r,className:ke("text-lg font-semibold text-foreground",e),...t}));NV.displayName=dm.displayName;const PV=b.forwardRef(({className:e,...t},r)=>a.jsx(hm,{ref:r,className:ke("text-sm text-muted-foreground",e),...t}));PV.displayName=hm.displayName;const uTe="sidebar_state",dTe=3600*24*7,hTe="16rem",fTe="18rem",pTe="3rem",mTe="b",AV=b.createContext(null);function VP(){const e=b.useContext(AV);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}function gTe({defaultOpen:e=!0,open:t,onOpenChange:r,className:n,style:i,children:s,...o}){const l=aTe(),[u,d]=b.useState(!1),[f,p]=b.useState(e),g=t??f,v=b.useCallback(S=>{const j=typeof S=="function"?S(g):S;r?r(j):p(j),document.cookie=`${uTe}=${j}; path=/; max-age=${dTe}`},[r,g]),x=b.useCallback(()=>l?d(S=>!S):v(S=>!S),[l,v,d]);b.useEffect(()=>{const S=j=>{j.key===mTe&&(j.metaKey||j.ctrlKey)&&(j.preventDefault(),x())};return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[x]);const y=g?"expanded":"collapsed",_=b.useMemo(()=>({state:y,open:g,setOpen:v,isMobile:l,openMobile:u,setOpenMobile:d,toggleSidebar:x}),[y,g,v,l,u,d,x]);return a.jsx(AV.Provider,{value:_,children:a.jsx(eq,{delayDuration:0,children:a.jsx("div",{"data-slot":"sidebar-wrapper",style:{"--sidebar-width":hTe,"--sidebar-width-icon":pTe,...i},className:ke("group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",n),...o,children:s})})})}function vTe({side:e="left",variant:t="sidebar",collapsible:r="offcanvas",className:n,children:i,...s}){const{isMobile:o,state:l,openMobile:u,setOpenMobile:d}=VP();return r==="none"?a.jsx("div",{"data-slot":"sidebar",className:ke("bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col",n),...s,children:i}):o?a.jsx(oTe,{open:u,onOpenChange:d,...s,children:a.jsxs(kV,{"data-sidebar":"sidebar","data-slot":"sidebar","data-mobile":"true",className:"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden",style:{"--sidebar-width":fTe},side:e,children:[a.jsxs(EV,{className:"sr-only",children:[a.jsx(NV,{children:"Sidebar"}),a.jsx(PV,{children:"Displays the mobile sidebar."})]}),a.jsx("div",{className:"flex h-full w-full flex-col",children:i})]})}):a.jsxs("div",{className:"group peer text-sidebar-foreground hidden md:block","data-state":l,"data-collapsible":l==="collapsed"?r:"","data-variant":t,"data-side":e,"data-slot":"sidebar",children:[a.jsx("div",{"data-slot":"sidebar-gap",className:ke("relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]":"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]")}),a.jsx("div",{"data-slot":"sidebar-container",className:ke("fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]":"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l",n),...s,children:a.jsx("div",{"data-sidebar":"sidebar","data-slot":"sidebar-inner",className:"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm",children:i})})]})}function yTe({className:e,onClick:t,...r}){const{toggleSidebar:n}=VP();return a.jsxs(se,{"data-sidebar":"trigger","data-slot":"sidebar-trigger",variant:"ghost",size:"icon",className:ke("h-7 w-7",e),onClick:i=>{t?.(i),n()},...r,children:[a.jsx(QX,{}),a.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})}function xTe({className:e,...t}){return a.jsx("div",{"data-slot":"sidebar-header","data-sidebar":"header",className:ke("flex flex-col gap-2 p-2",e),...t})}function bTe({className:e,...t}){return a.jsx("div",{"data-slot":"sidebar-footer","data-sidebar":"footer",className:ke("flex flex-col gap-2 p-2",e),...t})}function _Te({className:e,...t}){return a.jsx("div",{"data-slot":"sidebar-content","data-sidebar":"content",className:ke("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t})}function wTe({className:e,...t}){return a.jsx("ul",{"data-slot":"sidebar-menu","data-sidebar":"menu",className:ke("flex w-full min-w-0 flex-col gap-1",e),...t})}function STe({className:e,...t}){return a.jsx("li",{"data-slot":"sidebar-menu-item","data-sidebar":"menu-item",className:ke("group/menu-item relative",e),...t})}const CTe=Wd("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:p-0!"}},defaultVariants:{variant:"default",size:"default"}});function jTe({asChild:e=!1,isActive:t=!1,variant:r="default",size:n="default",tooltip:i,className:s,...o}){const l=e?jE:"button",{isMobile:u,state:d}=VP(),f=a.jsx(l,{"data-slot":"sidebar-menu-button","data-sidebar":"menu-button","data-size":n,"data-active":t,className:ke(CTe({variant:r,size:n}),s),...o});return i?(typeof i=="string"&&(i={children:i}),a.jsxs(fJ,{children:[a.jsx(pJ,{asChild:!0,children:f}),a.jsx(tq,{side:"right",align:"center",hidden:d!=="collapsed"||u,...i})]})):f}function kTe(){const{isDark:e,toggleDark:t}=VE();return a.jsx(se,{size:"icon",variant:"ghost",onClick:t,children:e?a.jsx(tQ,{className:"h-4 w-4"}):a.jsx(XX,{className:"h-4 w-4"})})}function ETe({children:e}){const{user:t,isLoading:r}=vJ(),[n]=w3(),{background:i,logoUrl:s,systemName:o}=VE(),{t:l}=Tr(),{data:u,isLoading:d}=Pt({queryKey:["/api/server/check-admin"],queryFn:async()=>{const x=await fetch("/api/server/check-admin",{credentials:"include"});return x.ok?x.json():null},enabled:!!t});if(r)return a.jsx("div",{className:"flex h-screen items-center justify-center bg-background text-foreground",children:a.jsx("div",{className:"animate-pulse",children:l.common.loading})});if(!t)return a.jsx(iTe,{});const f=[{title:l.menu.dashboard,url:"/",icon:UX},{title:l.menu.manufacturers,url:"/manufacturers",icon:qX},{title:l.menu.equipment,url:"/equipment",icon:vr},{title:"Credenciais",url:"/credentials",icon:so},{title:l.menu.scripts,url:"/scripts",icon:pa},{title:l.menu.executeBackup,url:"/backup-execute",icon:_l},{title:l.menu.backups,url:"/backups",icon:Ec},{title:l.menu.scheduler,url:"/scheduler",icon:Iv},{title:l.menu.firmware,url:"/firmware",icon:yv},{title:l.menu.terminal,url:"/terminal",icon:eQ},{title:l.menu.agents,url:"/agents",icon:ss},{title:l.menu.administration,url:"/admin",icon:Nc}],p=u?.isServerAdmin?[...f,{title:"Empresas",url:"/companies",icon:no},{title:l.menu.nbmCloudServer,url:"/server",icon:BX}]:f,g=u?.isServerAdmin,v=i?.type==="gradient"?{background:i.value}:{};return a.jsxs(gTe,{children:[i?.type==="dynamic"&&a.jsx(Kee,{type:i.value}),a.jsxs("div",{className:"flex h-screen w-full bg-background",style:v,children:[a.jsxs(vTe,{className:"border-r border-border bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/80",children:[a.jsx(xTe,{className:"p-4 border-b",children:a.jsxs("div",{className:"flex items-center gap-3",children:[s?a.jsx("img",{src:s,alt:"Logo",className:"w-8 h-8 rounded-lg object-contain"}):a.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary flex items-center justify-center",children:a.jsx(vr,{className:"h-5 w-5 text-primary-foreground"})}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-bold text-sm leading-none",children:o||"NBM CLOUD"}),a.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Network Backup Management"})]})]})}),a.jsx("div",{className:"px-3 py-2",children:a.jsxs("div",{className:"relative",children:[a.jsx(ra,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),a.jsx(Ne,{placeholder:`${l.common.search}...`,className:"h-9 pl-8 text-sm bg-muted/50 border-0 focus-visible:ring-1"})]})}),a.jsx(_Te,{className:"px-2",children:a.jsx(wTe,{children:p.map(x=>a.jsx(STe,{children:a.jsx(jTe,{asChild:!0,isActive:n===x.url,className:"data-[active=true]:bg-primary/10 data-[active=true]:text-primary",children:a.jsxs(Bf,{href:x.url,children:[a.jsx(x.icon,{className:"h-4 w-4"}),a.jsx("span",{children:x.title})]})})},x.title))})}),a.jsxs(bTe,{className:"p-4 border-t",children:[g&&a.jsx("div",{className:"mb-2 flex items-center justify-center",children:a.jsxs(Qe,{variant:"default",className:"gap-1 bg-amber-500 hover:bg-amber-600 text-white",children:[a.jsx(_x,{className:"h-3 w-3"}),l.menu.superAdmin]})}),a.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-muted/50",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold text-xs",children:(t?.username||"U")[0].toUpperCase()}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium truncate",children:t?.username}),a.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t?.email})]}),a.jsx(se,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>fetch("/api/auth/logout",{method:"POST",credentials:"include"}).then(()=>window.location.reload()),children:a.jsx(KX,{className:"h-3.5 w-3.5"})})]})]})]}),a.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[a.jsxs("header",{className:"flex h-14 items-center justify-between gap-4 px-6 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(yTe,{}),a.jsx("h1",{className:"text-sm font-semibold",children:p.find(x=>x.url===n)?.title||"NBM"})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(Vee,{}),a.jsx(kTe,{})]})]}),a.jsx("main",{className:"flex-1 overflow-auto bg-muted/10",children:e})]})]})]})}function NTe(){return a.jsxs(rY,{children:[a.jsx(Kn,{path:"/",component:Gxe}),a.jsx(Kn,{path:"/equipment",component:ISe}),a.jsx(Kn,{path:"/backup-execute",component:j1e}),a.jsx(Kn,{path:"/scheduler",component:UCe}),a.jsx(Kn,{path:"/backups",component:g1e}),a.jsx(Kn,{path:"/scripts",component:A1e}),a.jsx(Kn,{path:"/manufacturers",component:O1e}),a.jsx(Kn,{path:"/firmware",component:tCe}),a.jsx(Kn,{path:"/terminal",component:zCe}),a.jsx(Kn,{path:"/execute",component:k1e}),a.jsx(Kn,{path:"/agents",component:n2e}),a.jsx(Kn,{path:"/agent-console",component:SPe}),a.jsx(Kn,{path:"/admin",component:eCe}),a.jsx(Kn,{path:"/server",component:TPe}),a.jsx(Kn,{path:"/companies",component:XAe}),a.jsx(Kn,{path:"/credentials",component:ZAe}),a.jsx(Kn,{component:sTe})]})}function PTe(){return a.jsx(wY,{client:dt,children:a.jsx(xJ,{children:a.jsx(bJ,{children:a.jsx(_J,{children:a.jsxs(eq,{children:[a.jsx(ETe,{children:a.jsx(NTe,{})}),a.jsx($Q,{})]})})})})})}MG.createRoot(document.getElementById("root")).render(a.jsx(PTe,{}));
root@SRV-NBM-CLOUD-01[/opt/nbm-cloud]# 
